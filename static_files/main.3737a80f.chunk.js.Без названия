(this["webpackJsonpchat-tsum"]=this["webpackJsonpchat-tsum"]||[]).push([[0],{100:function(e,t,a){e.exports={hidden:"form-radio_hidden__1KUAC",radio:"form-radio_radio__3jEtq",check:"form-radio_check__1qyKV"}},101:function(e,t,a){e.exports={typing:"typing-notify_typing__2rbRv","typing-points":"typing-notify_typing-points__2FlW_","typing-points--hidden":"typing-notify_typing-points--hidden__2AJs0"}},102:function(e,t,a){e.exports={dialog:"dialog_dialog__27far","dialog-inner":"dialog_dialog-inner__3bfO-","no-overflow":"dialog_no-overflow__2ONzY","messages-wrapper":"dialog_messages-wrapper__3lgZE"}},113:function(e,t){},114:function(e,t){},123:function(e,t,a){e.exports={radioLine:"form-radio-group-single_radioLine__34hW9",radioList:"form-radio-group-single_radioList__3RBjR"}},13:function(e,t,a){e.exports={"talk-bubble-wrapper":"talk-bubble_talk-bubble-wrapper__1M9QH","talk-bubble-outer":"talk-bubble_talk-bubble-outer__2o3w0","talk-bubble":"talk-bubble_talk-bubble__1xv-l","talk-bubble__message":"talk-bubble_talk-bubble__message__3kswH",pip:"talk-bubble_pip__27UBX",circle:"talk-bubble_circle__2Fech",avatar:"talk-bubble_avatar__1qGs8",time:"talk-bubble_time__1fIL4","talk-bubble-outer__consumer":"talk-bubble_talk-bubble-outer__consumer__2bHnR","talk-bubble-outer__tsum":"talk-bubble_talk-bubble-outer__tsum__2kNZm","talk-bubble-outer__operator":"talk-bubble_talk-bubble-outer__operator__1tYC9","system-message":"talk-bubble_system-message__3UJtn","start-message":"talk-bubble_start-message__14x7j",archive:"talk-bubble_archive__KAMAY",line:"talk-bubble_line__1ezBA",label:"talk-bubble_label__3Usek","archive-end":"talk-bubble_archive-end__2MG1A"}},155:function(e,t){},161:function(e,t){},172:function(e,t,a){e.exports={"scrollbar-wrapper":"scrollbar_scrollbar-wrapper__PhKgb","scrollbar-scroller":"scrollbar_scrollbar-scroller__21Kqw","scrollbar-content":"scrollbar_scrollbar-content__i5R4p","no-overflow":"scrollbar_no-overflow__2wkbU","scroll-track":"scrollbar_scroll-track__3SAwr","scroll-track-y":"scrollbar_scroll-track-y__3KwSy","scroll-gutter":"scrollbar_scroll-gutter__z1QY8","show-scroll":"scrollbar_show-scroll__C3qb1"}},179:function(e,t,a){},222:function(e,t){},240:function(e,t){},245:function(e,t,a){},250:function(e,t,a){},252:function(e,t,a){},253:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),s=a(168),i=a.n(s),o=(a(179),a(6)),c=a(7),l=a(4),u=a(11),h=a(10),d=a(173),p=a(35),f=a(1),v=a(60),m=a(53),b=a.n(m),g=a(90),y=a(36),O=function(e,t,a){return function(s){var i=Object(n.useState)(s.initialState||a),o=Object(y.a)(i,2),c=o[0],l=o[1];return e(l),r.a.createElement(t,{value:c},s.children)}},j=function(e){return function(t){return function(a){return function(n){return r.a.createElement(e,null,(function(e){return function(e){return r.a.createElement(a,e)}(Object(f.a)(Object(f.a)({},n),t(e||{})))}))}}}},S=function(e){var t,a=e.initialState,r=e.actionsCreators,s=void 0===r?{}:r,i=Object(n.createContext)({}),o=a,c=function(){var e=Object(g.a)(b.a.mark((function e(a){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=Object(f.a)(Object(f.a)({},o),a),t(o);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),l=Object.keys(s).reduce((function(e,t){return Object(f.a)(Object(f.a)({},e),{},Object(v.a)({},t,(function(){for(var e=arguments.length,a=new Array(e),n=0;n<e;n++)a[n]=arguments[n];var r=s[t].apply(s,[o,l].concat(a));return c(r)})))}),{}),u=O((function(e){t=e}),i.Provider,a);return{Provider:u,connect:j(i.Consumer),actions:l}},w=a(9),E=a(91),_=a.n(E),k="chatTsum",T=function(){function e(){Object(o.a)(this,e)}return Object(c.a)(e,[{key:"getFeature",value:function(e){var t=localStorage.getItem(k),a=t?JSON.parse(t):{};return a[e]?a[e]:null}},{key:"setFeature",value:function(e,t){var a=localStorage.getItem(k),n=a?JSON.parse(a):{};n[e]?Array.isArray(t)?n[e]=[].concat(Object(w.a)(n[e]),Object(w.a)(t)):n[e]=Object(f.a)(Object(f.a)({},n[e]),t):n[e]=t,localStorage.setItem(k,JSON.stringify(n))}},{key:"updateStore",value:function(e){localStorage.setItem(k,JSON.stringify(e))}},{key:"getStore",value:function(){var e=localStorage.getItem(k);return e?JSON.parse(e):{}}},{key:"getStoreAsString",value:function(){return localStorage.getItem(k)||""}}],[{key:"getInstance",value:function(){var t=localStorage.getItem(k);return t&&!_()(t,{})||localStorage.setItem(k,"{}"),e.instance||(e.instance=new e),e.instance}}]),e}();T.instance=void 0;var M=T.getInstance(),x={initialState:M.getFeature("chatHeader")||{chatTitle:"\u0427\u0430\u0442",avatarPath:"data:image/png;base64,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",userAvatar:"data:image/png;base64,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"},actionsCreators:{}},R=a(74),C="",A="https://tsum.hostedcc.ru/clientweb/api/v1",I="tsum.hostedcc.ru",D="https://tsum.hostedcc.ru/clientweb/chat-client-v4/",N=["image/png","image/jpeg","application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","text/plain","video/mp4","video/quicktime"],F=[".png",".jpg",".pdf",".doc",".docx",".txt",".mp4",".mov"],U=25690112,L="*** ",P=" ***",B="[ALL_OPERATORS_ARE_BUSY]",H="[TSUM_SYSTEM_MESSAGE]",W="[TSUM_ERROR_MESSAGE]",G="[TSUM_HIDE_THIS_MESSAGE]",z=/\.*\[TSUM_SEND_LAST_([\d]+)]\.*/,Q=/\[TSUM_SEND_MESSAGE_STOP:([\n\t ]*(?:&nbsp;)?)*(?:([",']{1})([\w\d\s\u0430-\u044f\u0410-\u042f\u0451\u0401.,:;!?@#$%()+\-=]+)*\2([;\n\t ]*(?:&nbsp;)?)*)*\1*]/,K=/("|')([\w\d\s\u0430-\u044f\u0410-\u042f\u0451\u0401.,:;!?@#$%()+\-=]+)*\1/g,J=[B,H,W],q=a(169),V=a.n(q),Y=new R.UAParser,Z=M.getFeature("config")||{appId:C,apiUrl:A,tenantUrl:I,chatPath:D,activeTab:"",isMobileAppleDevice:["iPhone","iPad","iPod"].includes(Y.getDevice().model),isMobile:["mobile"].includes(Y.getDevice().type),isTablet:["tablet"].includes(Y.getDevice().type),unsupportedDevice:"iPad"===Y.getDevice().model&&-1!==Y.getBrowser().name.indexOf("Safari")&&V.a.compare(Y.getOS().version,"12.4.0","<="),isIPad:"iPad"===Y.getDevice().model,origin:"",cdnOrigin:"",baseUrl:"",url:"",title:""};void 0===Z.logMessages&&(Z.logMessages=[]);var X,$,ee={setActiveTab:function(e,t,a){var n=Object(f.a)(Object(f.a)({},e),{},{config:Object(f.a)(Object(f.a)({},e.config),{},{activeTab:a})});return M.updateStore(n),n},setChatGlobalSettings:function(e,t,a){var n=Object(f.a)(Object(f.a)({},e),{},{config:Object(f.a)(Object(f.a)({},e.config),a)});return M.updateStore(n),n},setNavData:function(e,t,a){var n=Object(f.a)(Object(f.a)({},e),{},{config:Object(f.a)(Object(f.a)({},e.config),a)});return M.updateStore(n),n},log:function(e,t){for(var a=arguments.length,n=new Array(a>2?a-2:0),r=2;r<a;r++)n[r-2]=arguments[r];var s=[].concat(Object(w.a)(e.config.logMessages),[{text:n,date:Date.now()}]),i=Object(f.a)(Object(f.a)({},e),{},{config:Object(f.a)(Object(f.a)({},e.config),{},{logMessages:s})});return M.updateStore(i),i},clearLogs:function(e,t){var a=Object(f.a)(Object(f.a)({},e),{},{config:Object(f.a)(Object(f.a)({},e.config),{},{logMessages:[]})});return M.updateStore(a),a}},te={initialState:Z,actionsCreators:ee};!function(e){e.Dialog="Dialog",e.Poll="Poll",e.Message="Message"}(X||(X={})),function(e){e.PollShowed="chat_session_form_show",e.Typing="chat_session_typing",e.NotTyping="chat_session_not_typing",e.Signaling="chat_session_signaling",e.File="chat_session_file",e.Message="chat_session_message",e.FormData="chat_session_form_data",e.Status="chat_session_status",e.PartyJoined="chat_session_party_joined",e.PartyLeft="chat_session_party_left",e.TimeoutWarning="chat_session_timeout_warning",e.InactivityTimeout="chat_session_inactivity_timeout",e.Disconnect="chat_session_disconnect",e.Ended="chat_session_ended",e.Navigation="chat_session_navigation",e.End="chat_session_end"}($||($={}));var ae=M.getFeature("chat")||{chatIsAvailable:!1,chatIsOpened:!1,errors:[],events:[],archive:[],chat_id:"",ewt:"",is_new_chat:!1,state:"",lastMsgId:0,newMessages:0,sessionTerminated:!1,status:"not connected",currentStep:X.Dialog,pollForm:{isFirst:void 0,satisfaction:3,raw:5},pollFormData:{id:void 0,name:void 0},lastActivity:new Date(0)};void 0===ae.currentStep&&(ae.currentStep=X.Dialog),void 0===ae.lastActivity&&(ae.lastActivity=new Date(0)),void 0===ae.pollFormData&&(ae.pollFormData={id:void 0,name:void 0}),void 0===ae.pollForm&&(ae.pollForm={isFirst:void 0,satisfaction:3,raw:5});var ne={initialState:ae,actionsCreators:{setCheckAvailability:function(e,t,a){var n=Object(f.a)(Object(f.a)({},e),{},{chat:Object(f.a)(Object(f.a)({},e.chat),a)});return M.updateStore(n),n},setChat:function(e,t,a){var n=Object(f.a)(Object(f.a)({},e),{},{chat:Object(f.a)(Object(f.a)({},e.chat),a)});return M.updateStore(n),n},incrementLastMsgId:function(e,t){var a=Object(f.a)({},e);a.chat.lastMsgId++;var n=Object(f.a)(Object(f.a)({},e),a);return M.updateStore(n),n},updateChat:function(e,t,a){a.lastMsgId=Math.max(e.chat.lastMsgId,a.lastMsgId);var n=Object(f.a)(Object(f.a)({},e),{},{chat:a});return M.updateStore(n),n},updateEvents:function(e,t,a){var n=Object(f.a)(Object(f.a)({},e.chat),{},{events:[].concat(Object(w.a)(e.chat.events),Object(w.a)(a))}),r=Object(f.a)(Object(f.a)({},e),{},{chat:n});return M.updateStore(r),r},clearEvents:function(e,t){var a=Object(f.a)(Object(f.a)({},e.chat),{},{events:[]}),n=Object(f.a)(Object(f.a)({},e),{},{chat:a});return M.updateStore(n),n},archiveEvents:function(e,t,a){var n=Object(f.a)(Object(f.a)({},e.chat),{},{events:[],archive:e.chat.archive.concat(a),newMessages:0}),r=Object(f.a)(Object(f.a)({},e),{},{chat:n});return M.updateStore(r),r},updateAllStoreFromLocalStorage:function(e,t){return Object(g.a)(b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",M.getStore());case 1:case"end":return e.stop()}}),e)})))()},setCurrentStep:function(e,t,a){var n=Object(f.a)(Object(f.a)({},e),{},{chat:Object(f.a)(Object(f.a)({},e.chat),{},{currentStep:a})});return M.updateStore(n),n},setLastActivity:function(e,t){var a=Object(f.a)(Object(f.a)({},e),{},{chat:Object(f.a)(Object(f.a)({},e.chat),{},{lastActivity:new Date})});return M.updateStore(a),a},setPollFormData:function(e,t,a){var n=Object(f.a)(Object(f.a)({},e),{},{chat:Object(f.a)(Object(f.a)({},e.chat),{},{pollFormData:a})});return M.updateStore(n),n}}},re={initialState:M.getFeature("parties")||[],actionsCreators:{addParty:function(e,t,a){var n=Object(f.a)({},e);return n=e.parties.some((function(e){return e.party_id===a.party_id}))?Object(f.a)({},e):Object(f.a)(Object(f.a)({},e),{},{parties:[].concat(Object(w.a)(e.parties),[a])}),M.updateStore(n),n},replacePartyType:function(e,t,a,n){var r=Object(f.a)({},e),s=-1,i=r.parties.length;if(0===i)return r;for(var o=i-1;o>=0;o--)if(r.parties[o].party_id===a.party_id){s=o;break}return-1===s||(r.parties[s].type=n,M.updateStore(r)),r}}},se={initialState:M.getFeature("user-input")||{currentLength:0,maxLength:1200,showAfter:900},actionsCreators:{updateCurrentLength:function(e,t,a){var n=Object(f.a)({},e);return n=Object(f.a)(Object(f.a)({},e),{},{userInput:Object(f.a)(Object(f.a)({},e.userInput),{},{currentLength:a})}),M.updateStore(n),n}}},ie=M.getFeature("stopWords"),oe={initialState:Array.isArray(ie)&&ie.every((function(e){return"string"===typeof e}))?ie:[],actionsCreators:{setStopWords:function(e,t,a){var n=Object(f.a)(Object(f.a)({},e),{},{stopWords:a});return M.updateStore(n),n},clearStopWords:function(e,t){var a=Object(f.a)(Object(f.a)({},e),{},{stopWords:[]});return M.updateStore(a),a}}},ce=S({initialState:{chatHeader:x.initialState,config:te.initialState,chat:ne.initialState,parties:re.initialState,userInput:se.initialState,stopWords:oe.initialState},actionsCreators:Object(f.a)(Object(f.a)(Object(f.a)(Object(f.a)(Object(f.a)(Object(f.a)({},x.actionsCreators),te.actionsCreators),ne.actionsCreators),re.actionsCreators),se.actionsCreators),oe.actionsCreators)}),le=ce.Provider,ue=ce.connect,he=ce.actions;function de(e,t){if(!e)return!1;for(var a=arguments.length,n=new Array(a>2?a-2:0),r=2;r<a;r++)n[r-2]=arguments[r];return!(0!==n.length||!e.hasOwnProperty(t))||!!t&&de.apply(void 0,[e[t]].concat(n))}var pe=a(120),fe=a.n(pe),ve=a(265),me=a(268),be=a(85),ge=a.n(be),ye=localStorage.getItem("uuid");ye||(ye=JSON.stringify(Object(ve.a)()).replace(/"/g,""),localStorage.setItem("uuid",ye));var Oe={"Content-Type":"application/json; charset=UTF-8",Accept:"application/json, text/javascript, */*; q=0.01"};Oe.Authorization='MOBILE-API-140-327-PLAIN appId="'.concat(C,'", clientId="').concat(ye,'"');var je=function(){function e(){Object(o.a)(this,e)}return Object(c.a)(e,[{key:"sendRequestToClientWebserver",value:function(e,t,a,n){var r={method:e,url:A+"/"+t+"?tenantUrl="+encodeURIComponent(I)+"&timestamp="+(new Date).getTime(),body:a,headers:n?Object(f.a)(Object(f.a)({},Oe),n):Oe};return Object(me.a)(r)}},{key:"sendFormDataToClientWebserver",value:function(e,t,a,n){var r=A+"/"+t+"?tenantUrl="+encodeURIComponent(I)+"&timestamp="+(new Date).getTime(),s=Object(f.a)(Object(f.a)({},Oe),{"Content-Type":"multipart/form-data"}),i=new FormData;i.append("file-upload-input",a,a.name);var o={method:e,url:r,data:i,headers:n?Object(f.a)(Object(f.a)({},s),n):s};return fe.a.request(o)}},{key:"sendFormFieldsToClientWebserver",value:function(e,t,a,n){var r=A+"/"+t+"?tenantUrl="+encodeURIComponent(I)+"&timestamp="+(new Date).getTime(),s=Object(f.a)({},Oe),i={method:e,url:r,data:a,headers:n?Object(f.a)(Object(f.a)({},s),n):s};return fe.a.request(i)}},{key:"checkAvailability",value:function(e){return this.sendRequestToClientWebserver("get","availability",{},e)}},{key:"getChat",value:function(e,t){return this.sendRequestToClientWebserver("post","chats",e,t)}},{key:"getActiveChat",value:function(e){return this.sendRequestToClientWebserver("get","chats/active",{},e)}},{key:"getHistory",value:function(e,t){return this.sendRequestToClientWebserver("get","chats/".concat(e,"/history"),{},t)}},{key:"getEvents",value:function(e,t){return this.sendRequestToClientWebserver("get","chats/".concat(e,"/events"),{},t)}},{key:"sendEvents",value:function(e,t,a){return this.sendRequestToClientWebserver("post","chats/".concat(e,"/events"),{events:t},a)}},{key:"sendPollForm",value:function(e,t,a){var n=t.pollFormData,r=t.form,s=A+"/chats/"+e+"/events?tenantUrl="+encodeURIComponent(I)+"&timestamp="+(new Date).getTime(),i=Object(f.a)({},Oe),o={method:"POST",url:s,data:{events:[{event:$.FormData,form_request_id:n.id,form_name:n.name,data:{first_call_resolution:r.isFirst?"\u0414\u0430":"\u041d\u0435\u0442",contact_satisfaction:String(r.satisfaction),NPS_raw:String(r.raw)}}]},headers:a?Object(f.a)(Object(f.a)({},i),a):i};return ge.a.request(o)}},{key:"sendFile",value:function(e,t){return this.sendFormDataToClientWebserver("post","files",e,t)}}],[{key:"getInstance",value:function(){return e.instance||(e.instance=new e),e.instance}}]),e}();je.instance=void 0;var Se=je.getInstance(),we=function(){function e(t,a,n){Object(o.a)(this,e),this.event="",this.eventEmitter=void 0,this.callback=void 0,this.event=t,this.eventEmitter=a,this.callback=n}return Object(c.a)(e,[{key:"unsubscribe",value:function(){if(this.event&&this.eventEmitter.events[this.event]){var e=this.eventEmitter.events[this.event].indexOf(this.callback);-1!==e&&(this.eventEmitter.events[this.event].splice(e,1),0===this.eventEmitter.events[this.event].length&&delete this.eventEmitter.events[this.event])}}}]),e}(),Ee={events:{},dispatch:function(e,t){this.events[e]&&this.events[e].forEach((function(e){return e(t)}))},subscribe:function(e,t){return this.events[e]||(this.events[e]=[]),this.events[e].push(t),new we(e,this,t)}};var _e,ke=a(37),Te=a(87),Me=a(59),xe=a(267),Re=a(255),Ce=a(256),Ae=function e(t){var a=t.text,n=t.type,r=t.code;Object(o.a)(this,e),this.text="",this.type="",this.code=200,this.isChatError=!0,this.text=a,this.type=n,this.code=r,this.isChatError=!0},Ie=a(201),De=[],Ne=/((https:\/\/|http:\/\/)?(?:[^/?#\s\n\t@\u0430-\u044f\u0410-\u042f\u0451\u0401.]+(\.[^/?#\s\n\t@.0-9]+)+){1}){1}(?:[/?#](?:[\w.]|=|&|-|\?)*)*/,Fe=/\b([\w.-]+@[\w.-]+\.\w{2,6})\b/,Ue=Object(ke.a)(J);try{for(Ue.s();!(_e=Ue.n()).done;){var Le=_e.value,Pe=Ie(Le).replace(/\[/g,"&#91;").replace(/\]/g,"&#93;");De.push(Le),De.push(Pe),De.push(Ie(Le))}}catch(bn){Ue.e(bn)}finally{Ue.f()}var Be=function(e){var t=0,a=0,n={},r=null,s=function n(){if(t&&a===t&&n.cancel(),e&&!r){var s=e.apply(void 0,arguments);return a++,s}if(r)return r.apply(void 0,arguments)};function i(e){var t="";if("object"!==typeof e||null===e)t=String(e);else for(var a in e)"object"!==typeof e[a]||null===e[a]?t+="_".concat(a,": ").concat(String(e[a]),"; "):t+=i(e[a]);return t}return s.cancel=function(){return e=null,s},s.once=function(){return t=1,s},s.timeout=function(e){return setTimeout((function(){s.cancel()}),e),s},s.limit=function(e){return t=e,s},s.memo=function(){return r=function(){for(var t=arguments.length,a=new Array(t),r=0;r<t;r++)a[r]=arguments[r];var s=i(a);if(s in n)return n[s];var o=e.apply(void 0,a);return n[s]=o,o},s},s};function He(e,t,a){return{party_id:e.party_id||"",first_name:e.first_name||"",last_name:e.last_name||"",display_name:e.display_name||"",type:t,session_id:a}}function We(e){if(!de(e,"response","events"))throw new Ae({text:"Response has no nested events."});return e.response.events}function Ge(e){return e.preventDefault(),e.stopPropagation(),!1}function ze(e){return e.forEach((function(e){e.timestamp||(e.timestamp=JSON.stringify(Date.now()))})),e}function Qe(e,t){for(var a=t.length-1;a>=0;a--){var n=!0;for(var r in e){if(!t[a][r]){n=!1;break}if(e[r]!==t[a][r]){n=!1;break}}if(n)return a}return-1}function Ke(e,t){for(var a=t.length-1;a>=0;a--)if(t[a].type===e)return t[a].party_id;return e}var Je=function(e){if(!de(e,"response","chat"))return Object(Te.a)(new Ae({text:"Chat availability response has no nested. properties."}));var t="available"===e.response.chat;return he.setCheckAvailability({chatIsAvailable:t}),t?Object(Me.a)(!0):Object(Te.a)(new Ae({text:"Chat service is not available."}))},qe=function(e){if(!de(e,"response","state"))return Object(Te.a)(new Ae({text:"Server answer has no state in data"}));var t="connected"===e.response.state;return he.setChat(Object(f.a)(Object(f.a)({},e.response),{},{sessionTerminated:!1,status:t?"connected":"connected, no operators"})),Object(Me.a)(e)};function Ve(e,t,a){return e.forEach((function(n){if(function(e,t,a){return a?t.some((function(t){return t.session_id===a&&t.party_id===e.party_id})):t.some((function(t){return t.party_id===e.party_id}))}(n,a,t.chat_id))return e;n.event===$.PartyJoined?(("connected"!==t.status||t.sessionTerminated)&&he.setChat({sessionTerminated:!1,status:"connected"}),he.addParty(He(n,"operator",t.chat_id))):n.event===$.Message&&he.addParty(He(n,"tsum",t.chat_id))})),e}function Ye(e,t,a,n){he.incrementLastMsgId();var r=e.url||e.absoluteUrl||"",s=e.title||e.absoluteUrl||"",i={event:$.Navigation,page:r.indexOf("http")>-1?r:a+e.url,title:s,msg_id:t.lastMsgId.toString()};return Se.sendEvents(t.chat_id,[i],n)}function Ze(e,t,a){return e.filter((function(e){return[$.InactivityTimeout,$.Disconnect,$.Ended].includes(e.event)})).length>0&&(t(),Ee.dispatch("new messages",{type:"new messages",data:a})),e}function Xe(e){var t=e.filter((function(e){return[$.Message,$.File,$.PartyJoined,$.PartyLeft,$.Disconnect,$.TimeoutWarning,$.InactivityTimeout,$.Ended].includes(e.event)})).filter((function(e){return!e.msg&&!e.file_name||(e.msg?!z.test(e.msg)&&!e.msg.includes(G):!e.file_name||!/hide_file$/.test(e.file_name))}));he.archiveEvents(t)}function $e(e){return!!e&&(Fe.test(e)?"email":!!Ne.test(e)&&"url")}function et(e,t){if(!e)return"";if(-1!==e.indexOf(H))return e;var a="url"===t?Ne:Fe,n=e.replace(/&amp;/g,"&"),r="",s=a.exec(n);if(s){r+=n.substr(0,s.index),n=n.substr(s.index+s[0].length,n.length);var i=s[0];"url"===t?s[2]?r+='<a href="'.concat(i,'" target="_blank">').concat(i,"</a>"):r+='<a href="http://'.concat(i,'" target="_blank">').concat(i,"</a>"):r+='<a href="mailto:'.concat(i,'" target="_blank">').concat(i,"</a>"),r+=n}else r=e;return r}function tt(e){if(!e)return"";if(!$e(e))return e;var t,a=e.split(/[\s\t\n]{1}|<br>|<br \/>/gm),n=[],r=e,s="",i=Object(ke.a)(a);try{for(i.s();!(t=i.n()).done;){var o=t.value,c=$e(o);c?n.push(et(o,c)):n.push(o)}}catch(bn){i.e(bn)}finally{i.f()}for(var l=0;l<a.length;l++){var u=r.indexOf(a[l]),h=a[l].length,d=r.slice(0,u+h);r=r.slice(u+h),s+=d.replace(a[l],n[l])}return s}function at(e){if(0===e.length)return e;for(var t=e.length,a=Object(w.a)(e),n=0;n<t;n++)[$.PartyLeft,$.InactivityTimeout,$.Disconnect,$.Ended].includes(a[n].event)&&a[n].event===$.PartyLeft&&(a.splice(n,1),t=a.length,n--);return a}function nt(e,t){if(0===e.filter((function(e){return e.event===$.Message})).length)return e;for(var a=Object(w.a)(e),n=a.length,r=function(e){if(a[e].event!==$.Message)return"continue";var n=t.find((function(t){return t.party_id===a[e].party_id}));return n?"consumer"!==n.type?"continue":void(a[e].msg=tt(a[e].msg)):"continue"},s=0;s<n;s++)r(s);return a}function rt(e){if(!e)return!1;return/^.*\.(?:jpg|JPG|jpeg|JPEG|png|PNG|gif|GIF)(?:\?hide_file)?$/.test(e)}function st(e,t){var a=t.events,n=Qe({event:$.File,file_name:e.data.file_name,inQuery:!0},t.events);return-1===n?{event:$.File,file_name:"",inQuery:!1}:Object(f.a)(Object(f.a)({},a[n]),{},{file_id:e.data.file_id,file_type:rt(a[n].file_name)?"image":"attachment",msg_id:t.lastMsgId.toString()})}function it(e,t){var a=Object(w.a)(t.events);e.forEach((function(e){if(e&&e.event===$.File){var n=Qe({event:e.event,file_name:e.file_name,inQuery:!0},t.events);-1!==n&&(a[n]=e)}})),he.updateChat(Object(f.a)(Object(f.a)({},t),{},{events:Object(w.a)(a)}))}function ot(e,t){var a=Object(w.a)(t.events);return e.forEach((function(e){if(e)if(e.event===$.File){var n=Qe({event:e.event,file_name:e.file_name,inQuery:!0},t.events);-1!==n&&(a[n]=Object(f.a)(Object(f.a)({},e),{},{inQuery:!1}))}else if(e.event===$.Message){var r=Qe({event:e.event,msg:e.msg,inQuery:!0},t.events);-1!==r&&(a[r]=Object(f.a)(Object(f.a)({},e),{},{inQuery:!1}))}})),he.setChat(Object(f.a)(Object(f.a)({},t),{},{events:Object(w.a)(a)})),e}function ct(e,t,a,n){return e.pipe(Object(xe.a)(1e3*t),Object(Re.a)((function(e){e instanceof Ae||de(e,"response","status")&&404===e.status&&(a(),n())})))}function lt(e,t){if(!e)return"";if(e.length<=t)return e;var a=e.substr(0,Math.floor(t/2)),n=e.substr(-Math.ceil(t/2));return"".concat(a,"...").concat(n)}function ut(e,t,a){return N.includes(e.type)&&e.size<U?{event:$.File,file_name:e.name,inQuery:!0,session_id:t,party_id:a,timestamp:Date.now().toString()}:N.includes(e.type)?e.size>=U?{event:$.Message,inQuery:!0,party_id:a,timestamp:Date.now().toString(),msg:"".concat(W,"\u0424\u0430\u0439\u043b \xab").concat(lt(e.name,15),"\xbb \u043f\u0440\u0435\u0432\u044b\u0448\u0430\u0435\u0442 \u0440\u0430\u0437\u0440\u0435\u0448\u0435\u043d\u043d\u044b\u0439 \u0440\u0430\u0437\u043c\u0435\u0440 \u0432 24 \u041c\u0431.")}:{event:$.Message,inQuery:!0,party_id:a,timestamp:Date.now().toString(),msg:"".concat(W,"\u0424\u0430\u0439\u043b \xab").concat(lt(e.name,15),"\xbb \u043f\u0440\u0435\u0432\u044b\u0448\u0430\u0435\u0442 \u0440\u0430\u0437\u0440\u0435\u0448\u0435\u043d\u043d\u044b\u0439 \u0440\u0430\u0437\u043c\u0435\u0440 \u0432 24 \u041c\u0431 \u0438 \u0438\u043c\u0435\u0435\u0442 \u043d\u0435\u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u044b\u0439 \u0442\u0438\u043f. \u0412\u043e\u0437\u043c\u043e\u0436\u043d\u0430 \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u0442\u043e\u043b\u044c\u043a\u043e \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0438\u0445 \u0442\u0438\u043f\u043e\u0432 \u0444\u0430\u0439\u043b\u043e\u0432: ").concat(F.join(", "),".")}:{event:$.Message,inQuery:!0,party_id:a,timestamp:Date.now().toString(),msg:"".concat(W,"\u041d\u0435\u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u044b\u0439 \u0442\u0438\u043f \u0443 \u0444\u0430\u0439\u043b\u0430 \xab").concat(lt(e.name,15),"\xbb. \u0412\u043e\u0437\u043c\u043e\u0436\u043d\u0430 \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u0442\u043e\u043b\u044c\u043a\u043e \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0438\u0445 \u0442\u0438\u043f\u043e\u0432 \u0444\u0430\u0439\u043b\u043e\u0432: ").concat(F.join(", "),".")}}function ht(e,t){if(0===e.length)return e;var a=e.filter((function(e){return![$.Typing,$.NotTyping].includes(e.event)}));if(0===a.length)return e;var n=function(e,t){var a=e.reduce((function(a,n){if(0===e.length)return t;if("msg_id"in n&&"string"===typeof n.msg_id&&-1===n.msg_id.indexOf("-")){var r=parseInt(""+n.msg_id);return isNaN(r)?a:Math.max(a,r)}return a}),0);return Math.max(a,t)}(a=[].concat(Object(w.a)(t.events),Object(w.a)(a)),t.lastMsgId),r=Object(f.a)(Object(f.a)({},t),{},{events:a,lastMsgId:n});return he.updateChat(r),e}function dt(){Ee.dispatch("all operators are busy")}function pt(){Ee.dispatch("operator's first message")}function ft(e){var t,a=Object(ke.a)(e);try{for(a.s();!(t=a.n()).done;){var n=t.value;n.event&&n.event===$.PartyJoined&&Ee.dispatch("operator joins chat")}}catch(bn){a.e(bn)}finally{a.f()}return e}function vt(e){var t,a=Be(dt).once(),n=Object(ke.a)(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;r.msg&&-1!==r.msg.indexOf(B)&&a(),[$.InactivityTimeout,$.Disconnect,$.Ended].includes(r.event)&&Ee.dispatch("chat session closed")}}catch(bn){n.e(bn)}finally{n.f()}return e}function mt(e,t){if(e.event!==$.File){var a=t.find((function(t){return t.party_id===e.party_id}));if(!a)return[Object(f.a)(Object(f.a)({},e),{},{msg:"".concat(G,"<br><br>\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u0435\u043b\u044c \u043d\u0435\u043e\u043f\u043e\u0437\u043d\u0430\u043d:<br>").concat(e.msg?e.msg:"")})];switch(a.type){case"tsum":return[Object(f.a)(Object(f.a)({},e),{},{msg:"".concat(G,"<br><br>\u0426\u0423\u041c, \u0441\u0438\u0441\u0442\u0435\u043c\u043d\u043e\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435:<br>").concat(e.msg?e.msg:"")})];case"consumer":return[Object(f.a)(Object(f.a)({},e),{},{msg:"".concat(G,"<br><br>\u041f\u043e\u043a\u0443\u043f\u0430\u0442\u0435\u043b\u044c").concat(a.display_name?" "+a.display_name:"",":<br>").concat(e.msg?e.msg:"")})];case"operator":return[Object(f.a)(Object(f.a)({},e),{},{msg:"".concat(G,"<br><br>\u041a\u043e\u043d\u0441\u0443\u043b\u044c\u0442\u0430\u043d\u0442").concat(a.display_name?" "+a.display_name:"",":<br>").concat(e.msg?e.msg:"")})];default:return[Object(f.a)(Object(f.a)({},e),{},{msg:"".concat(G,"<br><br>\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u0435\u043b\u044c \u043d\u0435\u043e\u043f\u043e\u0437\u043d\u0430\u043d:<br>").concat(e.msg?e.msg:"")})]}}else{var n=Object(f.a)(Object(f.a)({},e),{},{file_name:e.file_name+"?hide_file"});if(!e.party_id)return[{event:$.Message,msg:"".concat(G,"<br><br>\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u0435\u043b\u044c \u0444\u0430\u0439\u043b\u0430 \u043d\u0435\u043e\u043f\u043e\u0437\u043d\u0430\u043d:")},n];var r=t.find((function(t){return t.party_id===e.party_id}));if(!r)return[{event:$.Message,msg:"".concat(G,"<br><br>\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u0435\u043b\u044c \u0444\u0430\u0439\u043b\u0430 \u043d\u0435\u043e\u043f\u043e\u0437\u043d\u0430\u043d:")},n];switch(r.type){case"tsum":return[{event:$.Message,msg:"".concat(G,"<br><br>\u0424\u0430\u0439\u043b \u043e\u0442 \u0426\u0423\u041c\u0430: <br>")},n];case"operator":return[{event:$.Message,msg:"".concat(G,"<br><br>\u0424\u0430\u0439\u043b \u043e\u0442 \u043a\u043e\u043d\u0441\u0443\u043b\u044c\u0442\u0430\u043d\u0442\u0430 \u0426\u0423\u041c\u0430: <br>")},n];case"consumer":return[{event:$.Message,msg:"".concat(G,"<br><br>\u0424\u0430\u0439\u043b \u043e\u0442 \u043f\u043e\u043a\u0443\u043f\u0430\u0442\u0435\u043b\u044f: <br>")},n]}}}function bt(e,t,a,n,r){var s=[],i=0;try{for(var o=0;o<e.length;o++){var c;if((null===(c=e[o])||void 0===c?void 0:c.msg)&&z.test(String(e[o].msg))){var l,u=null===(l=e[o].msg.match(z))||void 0===l?void 0:l[1],h=Number(u);isNaN(h)||(i=Math.round(h))}else s.push(e[o])}if(i>0)if(0===t.length)r([{event:$.Message,msg:"".concat(G,"<br><br>").concat(L,"\u0423 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d \u0430\u0440\u0445\u0438\u0432 \u043f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0438\u0445 \u043e\u0431\u0440\u0430\u0449\u0435\u043d\u0438\u0439 \u0447\u0435\u0440\u0435\u0437 \u0447\u0430\u0442.").concat(P)}]).pipe(Object(Ce.a)(1)).subscribe();else if(i>t.length){for(var d=[],p=0;p<t.length;p++)d=d.concat(mt(t[p],a));r([{event:$.Message,msg:"".concat(G,"<br><br>").concat(L,"\u0410\u0440\u0445\u0438\u0432 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f").concat(P)}].concat(Object(w.a)(d),[{event:$.Message,msg:"".concat(G,"<br><br>").concat(L,"\u041a\u043e\u043d\u0435\u0446 \u043f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0435\u0439 \u043f\u0435\u0440\u0435\u043f\u0438\u0441\u043a\u0438 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f").concat(P)}])).pipe(Object(Ce.a)(1)).subscribe()}else{for(var f=[],v=t.slice(Math.max(t.length-i,0)),m=0;m<v.length;m++)f=f.concat(mt(v[m],a));r([{event:$.Message,msg:"".concat(G,"<br><br>").concat(L,"\u041f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u0435 ").concat(i," \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f").concat(P)}].concat(Object(w.a)(f),[{event:$.Message,msg:"".concat(G,"<br><br>").concat(L,"\u041a\u043e\u043d\u0435\u0446 \u043f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0435\u0439 \u043f\u0435\u0440\u0435\u043f\u0438\u0441\u043a\u0438 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f").concat(P)}])).pipe(Object(Ce.a)(1)).subscribe()}return s}catch(b){return e}}function gt(e){try{for(var t=[],a=0;a<e.length;a++){var n;if((null===(n=e[a])||void 0===n?void 0:n.msg)&&Q.test(String(e[a].msg))){var r,s=null===(r=e[a].msg)||void 0===r?void 0:r.match(Q),i=[];if(s){var o,c=null===s||void 0===s?void 0:s[0].matchAll(K),l=Object(ke.a)(c);try{for(l.s();!(o=l.n()).done;){var u=o.value;(null===u||void 0===u?void 0:u[2])&&i.push(u[2])}}catch(bn){l.e(bn)}finally{l.f()}he.setStopWords(i)}}else t.push(e[a])}return t}catch(h){return e}}function yt(e,t,a){if(t.length)for(var n=0;n<e.length;n++)for(var r=0;r<t.length;r++){var s,i;if(null===(s=e[n])||void 0===s||null===(i=s.msg)||void 0===i?void 0:i.includes(t[r]))return void a([{event:$.Message,msg:"".concat(G,"<br><br>..")}]).pipe(Object(Ce.a)(1)).subscribe()}}var Ot=Be((function(e){var t,a=e,n=Object(ke.a)(De);try{for(n.s();!(t=n.n()).done;){var r=t.value;-1!==e.indexOf(r)&&(a=a.replace(r,""))}}catch(bn){n.e(bn)}finally{n.f()}return a})).memo(),jt=Be(tt).memo();function St(e,t){for(var a=e.toString(),n=0;n<t;n++)a="0"+a;return a.substr(-t)}function wt(e){return e?Date.now().toString().length-e.length>2?1e3*parseInt(e):parseInt(e):0}function Et(e){var t=wt(e),a=new Date,n=new Date;n.setDate(a.getDate()-1);var r=new Date(t),s=St(a.getDate(),2),i=St(a.getMonth()+1,2),o=a.getFullYear().toString(10),c=(St(a.getHours(),2),St(a.getMinutes(),2),St(n.getDate(),2)),l=St(n.getMonth()+1,2),u=n.getFullYear().toString(10),h=(St(n.getHours(),2),St(n.getMinutes(),2),{day:St(r.getDate(),2),month:St(r.getMonth()+1,2),year:r.getFullYear().toString(10),hours:St(r.getHours(),2),minutes:St(r.getMinutes(),2)});return s===h.day&&i===h.month&&o===h.year?[h,"\u0441\u0435\u0433\u043e\u0434\u043d\u044f","today"]:c===h.day&&l===h.month&&u===h.year?[h,"\u0432\u0447\u0435\u0440\u0430","yesterday"]:i===h.month&&o===h.year?[h,"\u044d\u0442\u043e\u0442 \u043c\u0435\u0441\u044f\u0446","this month"]:o===h.year?[h,"\u044d\u0442\u043e\u0442 \u0433\u043e\u0434","this year"]:[h,"\u0434\u0430\u0432\u043d\u043e","long time ago"]}var _t,kt=a(25),Tt=a.n(kt);!function(e){e.Android="ANDROID",e.iPhone="IPHONE"}(_t||(_t={}));var Mt,xt=function(){function e(){Object(o.a)(this,e),this.uaParser=new R.UAParser,this.userAgent=this.uaParser.getUA(),this.mobileDeviceNames=[_t.Android,_t.iPhone]}return Object(c.a)(e,[{key:"is",value:function(e){return new RegExp(e.toLowerCase()).test(this.userAgent.toLowerCase())}},{key:"isMobile",value:function(){var e=this;return this.mobileDeviceNames.map((function(t){return e.is(t)})).reduce((function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;return e||t}))}},{key:"isMobileDeviceLong",value:function(){return this.isMobile()&&(window.innerHeight>800||window.innerWidth>800)}},{key:"isBrowser",value:function(e){return 0===this.uaParser.getBrowser().name.toLowerCase().indexOf(e)}},{key:"setUserAgent",value:function(e){this.uaParser=new R.UAParser(e)}}]),e}(),Rt=new xt,Ct=a(76),At=a.n(Ct);!function(e){e.Safari="safari",e.Chrome="chrome"}(Mt||(Mt={}));var It,Dt=Tt.a.bind(At.a),Nt=function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).chatInterTabBus=new BroadcastChannel("tsum-chat-bus"),n.headerRef=void 0,n.closeRef=void 0,n.headerRef=r.a.createRef(),n.closeRef=r.a.createRef(),n.preventEvents=n.preventEvents.bind(Object(l.a)(n)),n.closeChat=n.closeChat.bind(Object(l.a)(n)),n.close=n.close.bind(Object(l.a)(n)),n}return Object(c.a)(a,[{key:"componentDidMount",value:function(){this.chatInterTabBus.addEventListener("message",this.closeChat),this.closeRef.current&&(this.closeRef.current.addEventListener("click",this.close,!0),this.closeRef.current.addEventListener("touchstart",this.close,!0)),this.headerRef.current&&(this.headerRef.current.addEventListener("click",this.preventEvents,!0),this.headerRef.current.addEventListener("touchstart",this.preventEvents,!0),this.headerRef.current.addEventListener("touchmove",this.preventEvents,!0))}},{key:"componentWillUnmount",value:function(){this.chatInterTabBus.removeEventListener("message",this.closeChat),this.closeRef.current&&(this.closeRef.current.removeEventListener("click",this.close,!0),this.closeRef.current.removeEventListener("touchstart",this.close,!0)),this.headerRef.current&&(this.headerRef.current.removeEventListener("click",this.preventEvents,!0),this.headerRef.current.removeEventListener("touchstart",this.preventEvents,!0),this.headerRef.current.removeEventListener("touchmove",this.preventEvents,!0))}},{key:"preventEvents",value:function(e){this.closeRef.current&&e.target===this.closeRef.current||(e.stopPropagation(),e.preventDefault())}},{key:"closeChat",value:function(e){"close chat"===e.data&&this.props.close()}},{key:"close",value:function(e){e.stopPropagation(),e.preventDefault(),this.chatInterTabBus.postMessage("close chat"),this.props.close(),Ee.dispatch("deactivate textarea")}},{key:"render",value:function(){var e={"chat-roll-down":!0,"can-hover":!(this.props.config.isMobileAppleDevice&&Rt.isBrowser(Mt.Safari))},t={header:!0,"in-mobile-device":Rt.isMobile()};return r.a.createElement("header",{ref:this.headerRef,className:Dt(t)},r.a.createElement("div",{className:At.a.links}),r.a.createElement("div",{className:At.a["header-row"]},r.a.createElement("div",{className:At.a.title},this.props.chatHeader.chatTitle),r.a.createElement("a",{ref:this.closeRef,id:"close-ref",className:Dt(e),href:"#close-ref","data-testid":"CloseChatButton"},"\xd7")))}}]),a}(r.a.PureComponent),Ft=ue((function(e){return{chatHeader:e.chatHeader,config:e.config}}))(Nt),Ut=(a(245),function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){return this.props.chat.chatIsOpened?r.a.createElement(p.a,{to:"chat"}):r.a.createElement("div",{className:"default"},"DEFAULT")}}]),a}(r.a.PureComponent)),Lt=ue((function(e){return{chat:e.chat}}))(Ut),Pt=a(22),Bt=a(134),Ht=a(135),Wt=a(15),Gt=a(81),zt=a(136),Qt=a(124),Kt=a(121),Jt=a(19),qt=a(260),Vt=a(259),Yt=a(261),Zt=a(262),Xt=a(258),$t=a(263),ea=a(264);!function(e){e.IOS="iOS",e.WEB="web",e.ANDROID="Android"}(It||(It={}));var ta=a(77),aa=a.n(ta),na=Tt.a.bind(aa.a),ra=function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).attachFilesRef=void 0,n.attachFilesRef=r.a.createRef(),n.onChange=n.onChange.bind(Object(l.a)(n)),n.checkState=n.checkState.bind(Object(l.a)(n)),n}return Object(c.a)(a,[{key:"checkState",value:function(e){if(this.props.disabled)return e.stopPropagation(),void e.preventDefault()}},{key:"onChange",value:function(e){e.stopPropagation(),e.preventDefault(),e.target&&e.target.files&&(this.props.handleUserFiles(e.target.files),this.attachFilesRef.current&&(this.attachFilesRef.current.value=""))}},{key:"render",value:function(){var e={"attach-files-label":!0,"can-hover":!(this.props.isMobile||this.props.isTablet),disabled:this.props.disabled};return r.a.createElement("div",{className:aa.a["attach-file-outer"]},r.a.createElement("div",{className:aa.a["hide-input"]},r.a.createElement("input",{type:"file",ref:this.attachFilesRef,name:"attach-files",id:"attach-files",multiple:!0,accept:N.join(", "),onClick:this.checkState,onChange:this.onChange,"data-testid":"FileInput"})),r.a.createElement("label",{htmlFor:"attach-files",className:na(e)},r.a.createElement("div",{className:aa.a["label-icon"]})))}}]),a}(r.a.PureComponent),sa=a(99),ia=a.n(sa),oa=Tt.a.bind(ia.a),ca=function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).onDragLeave=n.onDragLeave.bind(Object(l.a)(n)),n.onDrop=n.onDrop.bind(Object(l.a)(n)),n.onDragOver=n.onDragOver.bind(Object(l.a)(n)),n}return Object(c.a)(a,[{key:"onDragOver",value:function(e){e.preventDefault()}},{key:"onDragLeave",value:function(e){if(e.target instanceof Element&&e.target.className.indexOf(ia.a["drop-zone-text"])>-1)return e.preventDefault(),void e.nativeEvent.stopImmediatePropagation();this.props.hideDropZone()}},{key:"onDrop",value:function(e){e.stopPropagation(),e.preventDefault(),this.props.handleUserFiles(e.dataTransfer.files),this.props.hideDropZone()}},{key:"render",value:function(){var e={"drop-zone":!0,"show-drop-zone":this.props.showDropZone};return r.a.createElement("form",{name:"file-form",method:"post"},r.a.createElement("div",{className:oa(e),onDragLeave:this.onDragLeave,onDragOver:this.onDragOver,onDrop:this.onDrop},r.a.createElement("span",{className:ia.a["drop-zone-text"]},"\u041f\u0435\u0440\u0435\u0442\u0430\u0449\u0438\u0442\u0435 \u0444\u0430\u0439\u043b\u044b \u0441\u044e\u0434\u0430, \u0447\u0442\u043e\u0431\u044b \u043e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u0438\u0445 \u043e\u043f\u0435\u0440\u0430\u0442\u043e\u0440\u0443")))}}]),a}(r.a.PureComponent),la=a(138),ua=a(137),ha=a(23),da=a(257),pa=a(266),fa=a(172),va=a.n(fa),ma=Tt.a.bind(va.a),ba=function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).scrollerRef=void 0,n.contentRef=void 0,n.scrollTrack=void 0,n.scrollGutter=void 0,n.touchStartCoords=[0,0],n.touchPreventExceptions=[],n.destroy$=new Pt.a,n.eventEmitterSubscriptions=[],n.scrollTimer=setTimeout((function(){})),n.contentHeightObserver$=Object(la.a)(50),n.state={contentOverflow:!1,gutterHeight:0,gutterPosition:0,showScroll:!!n.props.showScrollAlways&&n.props.showScrollAlways,nativeScrollbarWidth:0},n.touchPreventExceptions=n.props.touchPreventExceptions?n.props.touchPreventExceptions:[],n.scrollerRef=r.a.createRef(),n.contentRef=r.a.createRef(),n.scrollTrack=r.a.createRef(),n.scrollGutter=r.a.createRef(),n.isOverflowed=n.isOverflowed.bind(Object(l.a)(n)),n.scrollToBottom=n.scrollToBottom.bind(Object(l.a)(n)),n.touchstartPreventForScroller=n.touchstartPreventForScroller.bind(Object(l.a)(n)),n.touchstartPreventForContent=n.touchstartPreventForContent.bind(Object(l.a)(n)),n.touchmovePreventForContent=n.touchmovePreventForContent.bind(Object(l.a)(n)),n.dragContent=n.dragContent.bind(Object(l.a)(n)),n}return Object(c.a)(a,[{key:"touchstartPreventForContent",value:function(e){return!!(e.target&&e.target.className&&this.touchPreventsListContents(e.target.className))||(1===e.touches.length&&(this.touchStartCoords[0]=e.touches[0].clientX,this.touchStartCoords[1]=e.touches[0].clientY),"A"===e.target.tagName||"IMG"===e.target.tagName||(e.preventDefault(),e.stopPropagation(),!1))}},{key:"touchmovePreventForContent",value:function(e){return!!(e.target&&e.target.className&&this.touchPreventsListContents(e.target.className))||(1===e.changedTouches.length&&(this.dragContent(e),this.touchStartCoords[0]=e.changedTouches[0].clientX,this.touchStartCoords[1]=e.changedTouches[0].clientY),e.preventDefault(),e.stopPropagation(),!1)}},{key:"touchstartPreventForScroller",value:function(e){return e.target!==this.scrollerRef.current||(e.preventDefault(),e.stopPropagation(),!1)}},{key:"scrollToBottom",value:function(){this.scrollerRef.current&&this.scrollerRef.current.scrollTop!==this.scrollerRef.current.scrollHeight-this.scrollerRef.current.offsetHeight&&this.scrollerRef.current&&(this.scrollerRef.current.scrollTo?this.scrollerRef.current.scrollTo(0,this.scrollerRef.current.scrollHeight-this.scrollerRef.current.offsetHeight):this.scrollerRef.current.scrollTop=this.scrollerRef.current.scrollHeight-this.scrollerRef.current.offsetHeight,this.props.onUpdateScrolledToBottom&&this.props.onUpdateScrolledToBottom(!0))}},{key:"scrollTo",value:function(e){this.scrollerRef.current&&this.scrollerRef.current.scrollTop!==this.scrollerRef.current.scrollHeight-this.scrollerRef.current.offsetHeight&&this.scrollerRef.current&&(this.scrollerRef.current.scrollTo?this.scrollerRef.current.scrollTo(0,e):this.scrollerRef.current.scrollTop=e,this.props.onUpdateScrolledToBottom&&this.checkIfScrolledToBottom())}},{key:"dragContent",value:function(e){if(this.scrollerRef.current){var t=this.scrollerRef.current.scrollTop+(this.touchStartCoords[1]-e.changedTouches[0].clientY);this.scrollerRef.current.scrollTo({top:t,left:0})}}},{key:"isOverflowed",value:function(){if(!this.scrollerRef.current||!this.contentRef.current)return!1;var e=this.scrollerRef.current.clientHeight,t=this.contentRef.current.clientHeight;return!!e&&e<t}},{key:"calculateGutterHeight",value:function(){var e=this;this.scrollerRef.current&&this.contentRef.current&&0!==this.contentRef.current.scrollHeight&&this.setState({gutterHeight:Math.max(Math.round(this.scrollerRef.current.clientHeight*this.scrollerRef.current.clientHeight/this.contentRef.current.scrollHeight),16)},(function(){e.calculateGutterPosition()}))}},{key:"calculateGutterPosition",value:function(){var e=this;if(this.scrollTrack.current&&this.scrollerRef.current&&this.contentRef.current){var t=window.getComputedStyle(this.scrollTrack.current),a=window.getComputedStyle(this.scrollerRef.current),n=t.height?t.height:"0",r=a.height?a.height:"0",s=parseFloat(n),i=parseFloat(r),o=this.state.gutterHeight,c=this.scrollerRef.current.scrollTop/(this.contentRef.current.scrollHeight-i)*(s-o);clearTimeout(this.scrollTimer),this.props.showScrollAlways?this.setState({gutterPosition:c}):this.setState({gutterPosition:c,showScroll:!0},(function(){e.scrollTimer=setTimeout((function(){e.setState({showScroll:!1})}),2e3)}))}}},{key:"getNativeScrollbarWidth",value:function(){var e=document.createElement("div");e.style.overflowY="scroll",e.style.position="fixed",document.body.appendChild(e);var t=window.getComputedStyle(e)||"0",a="string"===typeof t.width?parseFloat(t.width):0;return e.parentNode&&e.parentNode.removeChild(e),a}},{key:"touchPreventsListContents",value:function(e){if(!this.touchPreventExceptions.length)return!1;var t,a=Object(ke.a)(this.touchPreventExceptions);try{for(a.s();!(t=a.n()).done;){var n=t.value;if(e.indexOf(n)>-1)return!0}}catch(bn){a.e(bn)}finally{a.f()}return!1}},{key:"recalculateScrollerRightOffset",value:function(){if(this.scrollerRef.current){var e=window.getComputedStyle(this.scrollerRef.current),t="string"===typeof e.right?parseFloat(e.right):0;this.scrollerRef.current.style.right=t-this.state.nativeScrollbarWidth+"px"}}},{key:"checkIfScrolledToBottom",value:function(){if(this.scrollTrack.current&&this.scrollerRef.current&&this.contentRef.current&&this.props.onUpdateScrolledToBottom){var e=this.scrollerRef.current.scrollTop,t=window.getComputedStyle(this.scrollerRef.current),a=t.height?t.height:"0",n=parseFloat(a),r=this.contentRef.current.scrollHeight;this.props.onUpdateScrolledToBottom(e+n>=r-1),this.props.onUpdateScrollTop&&this.props.onUpdateScrollTop(this.scrollerRef.current.scrollTop)}}},{key:"componentDidMount",value:function(){var e=this;this.scrollerRef.current&&(this.scrollerRef.current.addEventListener("touchstart",this.touchstartPreventForScroller,!0),this.scrollerRef.current.addEventListener("touchmove",this.touchstartPreventForScroller,!0)),this.contentRef.current&&(this.contentRef.current.addEventListener("touchstart",this.touchstartPreventForContent,{passive:!1}),this.contentRef.current.addEventListener("touchmove",this.touchmovePreventForContent,{passive:!1})),this.setState({nativeScrollbarWidth:this.getNativeScrollbarWidth()},(function(){e.state.nativeScrollbarWidth>0&&e.recalculateScrollerRightOffset()})),this.contentHeightObserver$.pipe(Object(Jt.a)(this.isOverflowed),Object(da.a)(),Object(Re.a)((function(t){e.setState({contentOverflow:t},(function(){e.state.contentOverflow&&e.calculateGutterHeight()}))})),Object(Xt.a)(this.destroy$)).subscribe(),Object(ua.a)(window,"resize").pipe(Object(pa.a)(40,ha.b,{leading:!0,trailing:!0}),Object(Re.a)((function(){return e.calculateGutterHeight()})),Object(Xt.a)(this.destroy$)).subscribe(),this.scrollerRef.current&&Object(ua.a)(this.scrollerRef.current,"scroll").pipe(Object(Re.a)((function(){return e.calculateGutterPosition()})),Object(Vt.a)(50),Object(Re.a)((function(){return e.checkIfScrolledToBottom()})),Object(Xt.a)(this.destroy$)).subscribe(),this.eventEmitterSubscriptions.push(Ee.subscribe("animation end",this.isOverflowed)),this.props.scrollToBottom&&this.scrollToBottom()}},{key:"componentDidUpdate",value:function(e){e.forceUpdate!==this.props.forceUpdate&&(this.calculateGutterHeight(),this.props.scrollToBottom&&this.props.scrolledToBottom?this.scrollToBottom():!this.props.scrolledToBottom&&this.props.scrollTop&&this.scrollTo(this.props.scrollTop))}},{key:"componentWillUnmount",value:function(){this.eventEmitterSubscriptions.forEach((function(e){return e.unsubscribe()})),this.scrollerRef.current&&(this.scrollerRef.current.removeEventListener("touchstart",this.touchstartPreventForScroller,!0),this.scrollerRef.current.removeEventListener("touchmove",this.touchstartPreventForScroller,!0)),this.contentRef.current&&(this.contentRef.current.removeEventListener("touchstart",this.touchstartPreventForContent),this.contentRef.current.removeEventListener("touchmove",this.touchmovePreventForContent)),this.destroy$.next(),this.destroy$.complete()}},{key:"render",value:function(){var e=this.props.offset?{marginRight:-this.props.offset+"px",paddingRight:this.props.offset+"px"}:{};return r.a.createElement("div",{className:ma({"scrollbar-wrapper":!0})},this.state.contentOverflow?r.a.createElement("div",{ref:this.scrollTrack,className:ma({"scroll-track":!0,"scroll-track-y":!0,"show-scroll":this.state.showScroll})},r.a.createElement("div",{ref:this.scrollGutter,className:ma({"scroll-gutter":!0}),style:{height:this.state.gutterHeight+"px",top:this.state.gutterPosition+"px"}})):null,r.a.createElement("div",{ref:this.scrollerRef,className:ma({"scrollbar-scroller":!0}),style:e},r.a.createElement("div",{ref:this.contentRef,className:ma({"scrollbar-content":!0,"no-overflow":!this.state.contentOverflow})},this.props.slot)))}}]),a}(r.a.PureComponent),ga={Yes:"\u0414\u0430",No:"\u041d\u0435\u0442"},ya={"\u0414\u0430":!0,"\u041d\u0435\u0442":!1},Oa=new Map([[!0,"\u0414\u0430"],[!1,"\u041d\u0435\u0442"]]);var ja=a(100),Sa=a.n(ja),wa=function(e){var t=e.value,a=e.isSelected,n=e.index,s=e.onChange,i=Object(ve.a)(),o={display:a?"block":"none"};return r.a.createElement(r.a.Fragment,null,r.a.createElement("input",{className:Sa.a.hidden,id:i,type:"radio",onChange:function(){return s(t,!a)},checked:a,value:t}),r.a.createElement("label",{onClick:function(){return s(t,!a)},onTouchStart:function(){return s(t,!a)},className:Sa.a.radio,htmlFor:i,"data-testid":"RadioButton-"+n},r.a.createElement("div",{style:o,className:Sa.a.check})))};wa.defaultProps={isSelected:!1};var Ea=a(123),_a=a.n(Ea),ka=function(e){var t=e.value,a=e.options,n=e.onChange,s=function(e){n(e)};return r.a.createElement("div",{className:_a.a.radioList},a.map((function(e,a){var n=t===e.value;return r.a.createElement("div",{className:_a.a.radioLine,key:e.value},r.a.createElement("div",null,r.a.createElement(wa,{value:e.value,isSelected:n,index:a,onChange:s})),r.a.createElement("label",{onClick:function(){return s(e.value)}},r.a.createElement("span",null,e.value)))})))};ka.defaultProps={options:[],value:""};var Ta,Ma,xa=a(57),Ra=a.n(xa),Ca=function(e){var t=e.value,a=e.max,s=e.min,i=e.onChange,o=Array(a-s+1).fill(null).map((function(e,t){return s+t})),c=Math.floor(s+(a-s)/2),l=Object(n.useState)(0),u=Object(y.a)(l,2),h=u[0],d=u[1],p=Object(n.useState)(c),v=Object(y.a)(p,2),m=v[0],b=v[1],g=Object(n.useState)(!1),O=Object(y.a)(g,2),j=O[0],S=O[1],w=Object(n.useRef)(null),E=Object(n.useRef)(null);function _(e){if(w&&w.current){var t,n,r=w.current.getBoundingClientRect(),o=r.left,c=r.width;e>=o&&e<=o+c?(t=(e-o)/c*100,n=1+Math.round((e-o)/Math.abs(c/(a-s)))):e<o?(t=0,n=s):(t=100,n=a),d(t),b(n),i(n)}}var k=Object(n.useCallback)(_,[w]);function T(e){_(e.clientX),S(!0)}function M(e){var t=e.targetTouches;t.length>1||(e.stopPropagation(),e.preventDefault(),_(t[0].clientX),S(!0))}function x(){S(!1)}return Object(n.useEffect)((function(){function e(){S(!1)}function t(){S(!1)}return j&&(window.addEventListener("mouseup",t),window.addEventListener("touchend",e)),function(){window.removeEventListener("mouseup",t),window.removeEventListener("touchend",e)}}),[j,S]),Object(n.useEffect)((function(){function e(e){var t=e.clientX,a=e.movementX;j&&0!==a&&k(t)}function t(e){var t=e.targetTouches;if(j)if(t.length>1)x();else{var a=t[0].clientX;k(a)}}return j&&(window.addEventListener("mousemove",e),window.addEventListener("touchmove",t)),function(){window.removeEventListener("mousemove",e),window.removeEventListener("touchmove",t)}}),[j,S,k]),r.a.createElement("div",{className:Ra.a["slider-wrapper"]},r.a.createElement("div",{className:Ra.a["range-slider"],onTouchStart:function(e){return M(e)},onMouseDown:function(e){return T(e)}},r.a.createElement("div",{className:Ra.a.rail,ref:w,style:{backgroundColor:"#dadce1",height:4,borderRadius:2}}),r.a.createElement("div",{className:Ra.a.track,style:Object(f.a)(Object(f.a)({},{backgroundColor:"#f94f0d",height:4}),{},{width:"".concat(j?h:100*Math.abs((m-s)/(a-s)),"%")})}),r.a.createElement("div",{className:Ra.a.handle,ref:E,role:"slider","aria-valuemax":a,"aria-valuemin":s,"aria-valuenow":t,style:Object(f.a)(Object(f.a)({},{width:"28px",height:"28px",boxShadow:"0 3px 1px 0 rgba(0, 0, 0, 0.1), 0 1px 1px 0 rgba(0, 0, 0, 0.16), 0 3px 8px 0 rgba(0, 0, 0, 0.15)",border:"solid 0.5px rgba(0, 0, 0, 0.04)",backgroundColor:" #ffffff",marginTop:-12}),{},{left:"".concat(j?h:100*Math.abs((m-s)/(a-s)),"%")}),onTouchStart:function(e){return M(e)},onMouseDown:function(e){return T(e)},onTouchEnd:function(){return x()},onMouseUp:function(){S(!1)}})),r.a.createElement("div",{className:Ra.a.stamps},o.map((function(e){return r.a.createElement("div",{key:e},r.a.createElement("span",null,e))}))))},Aa=a(32),Ia=a.n(Aa),Da=function(e){var t=e.onSubmit,a=e.onReset,s=e.form,i=Object(n.useState)(s.isFirst),o=Object(y.a)(i,2),c=o[0],l=o[1],u=Object(n.useState)(s.satisfaction),h=Object(y.a)(u,2),d=h[0],p=h[1],f=Object(n.useState)(s.raw),v=Object(y.a)(f,2),m=v[0],b=v[1],g=Object.values(ga).map((function(e){return{value:e}})),O=!("boolean"===typeof c)||!d||!m,j="";Rt.is(_t.Android)?j=" "+Ia.a["background--android"]:Rt.is(_t.iPhone)&&(j=" "+Ia.a["background--iphone"]),Rt.isMobileDeviceLong()&&(j=" "+Ia.a["background--mobile-long"]);return r.a.createElement("form",{className:Ia.a.background+j,onSubmit:function(e){var a=!O;e.preventDefault(),a&&t({isFirst:c,satisfaction:d,raw:m})},"data-testid":"PollForm"},r.a.createElement("div",null,r.a.createElement("p",{className:Ia.a.field__header},"\u0412\u0430\u0448 \u0432\u043e\u043f\u0440\u043e\u0441 \u0431\u044b\u043b \u0440\u0435\u0448\u0435\u043d \u0441 \u043f\u0435\u0440\u0432\u043e\u0433\u043e \u043e\u0431\u0440\u0430\u0449\u0435\u043d\u0438\u044f?"),r.a.createElement("div",null,r.a.createElement(ka,{options:g,value:Oa.get(c),onChange:function(e){if(!!(void 0===ya[e]||null===ya[e]))throw Error("".concat(e," is not key of PollIsFirstBoolean"));l(ya[e])}}))),r.a.createElement("div",{className:"field-slider"},r.a.createElement("p",{className:Ia.a["field-slider__header"]},"\u041e\u0446\u0435\u043d\u0438\u0442\u0435 \u043a\u0430\u0447\u0435\u0441\u0442\u0432\u043e \u043a\u043e\u043d\u0441\u0443\u043b\u044c\u0442\u0430\u0446\u0438\u0438 \u043e\u0442 1 \u0434\u043e 5"),r.a.createElement("div",{className:Ia.a["field-slider--control"]},r.a.createElement(Ca,{onChange:p,value:d,min:1,max:5}))),r.a.createElement("div",{className:"field-slider"},r.a.createElement("p",{className:Ia.a["field-slider__header"]},"\u041a\u0430\u043a\u043e\u0432\u0430 \u0432\u0435\u0440\u043e\u044f\u0442\u043d\u043e\u0441\u0442\u044c \u0442\u043e\u0433\u043e, \u0447\u0442\u043e \u0432\u044b \u043f\u043e\u0440\u0435\u043a\u043e\u043c\u0435\u043d\u0434\u0443\u0435\u0442\u0435 \u0426\u0423\u041c \u0441\u0432\u043e\u0438\u043c \u0434\u0440\u0443\u0437\u044c\u044f\u043c \u0438 \u0441\u0435\u043c\u044c\u0435?"),r.a.createElement("div",{className:Ia.a["field-slider--control"]},r.a.createElement(Ca,{onChange:b,value:m,min:1,max:10}))),r.a.createElement("div",{className:Ia.a.buttons},r.a.createElement("button",{className:Ia.a.reset,onClick:a,type:"button"},"\u041e\u0442\u043a\u0430\u0437\u0430\u0442\u044c\u0441\u044f"),r.a.createElement("button",{className:Ia.a.submit,disabled:O,type:"submit","data-testid":"PollFormSendButton"},"\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c")))},Na=a(101),Fa=a.n(Na);!function(e){e[e.Short=100]="Short",e[e.Normal=250]="Normal",e[e.Long=900]="Long"}(Ta||(Ta={})),function(e){e[e.Start=0]="Start",e[e.Finish=3]="Finish"}(Ma||(Ma={}));var Ua=function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).operatorTypingThread=0,n.delayPointShowThread=0,n.state={typingPoints:Ma.Start},n}return Object(c.a)(a,[{key:"cancelTypingPointsAnimation",value:function(){clearInterval(this.operatorTypingThread),clearTimeout(this.delayPointShowThread),this.setState({typingPoints:Ma.Start})}},{key:"startTypingPointsAnimation",value:function(){var e=this;clearInterval(this.operatorTypingThread),this.operatorTypingThread=window.setInterval((function(){var t=e.state.typingPoints===Ma.Finish?Ma.Start:e.state.typingPoints+1,a=Ta.Normal;e.state.typingPoints===Ma.Start&&(a=Ta.Short),t===Ma.Start&&(a=Ta.Long),e.delayPointShowThread=window.setTimeout((function(){e.setState({typingPoints:t})}),a)}),Ta.Normal)}},{key:"render",value:function(){var e=this,t=[1,2,3].map((function(t,a){var n=a+1<=e.state.typingPoints,s=Fa.a["typing-points"];return n||(s+=" "+Fa.a["typing-points--hidden"]),r.a.createElement("span",{key:String(t),className:s},".")}));return r.a.createElement("div",{className:Fa.a.typing,style:{display:this.props.typing?"block":"none"}},"\u043f\u0435\u0447\u0430\u0442\u0430\u0435\u0442",t)}}]),a}(r.a.PureComponent),La=a(66),Pa=a.n(La),Ba=Tt.a.bind(Pa.a),Ha=function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){var e=this.props.currentLength>this.props.maxLength;return r.a.createElement("div",{className:Pa.a.wrapper},this.props.currentLength>=this.props.showAfter?r.a.createElement("div",{className:Pa.a.counter},r.a.createElement("div",{className:Ba({numerator:!0,"max-length-overflowed":e})},this.props.currentLength),r.a.createElement("div",{className:Pa.a.delimiter},"/"),r.a.createElement("div",{className:Pa.a.denominator},this.props.maxLength)):null)}}]),a}(r.a.PureComponent),Wa=a(78),Ga=a.n(Wa),za=function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).chatInterTabBus=new BroadcastChannel("tsum-chat-bus"),n.minimalHeight=void 0,n.fakeTextareaRef=void 0,n.realTextareaRef=void 0,n.eventEmitterSubscriptions=[],n.firstOpenOnAndroidChrome=!0,n.state={currentRowsNumber:1,rowsBefore:0,rowsNow:1,lineHeight:17,scrollTop:0,scrolledToBottom:!0,scrollPositionUpdated:0},n.minimalHeight=17,n.fakeTextareaRef=r.a.createRef(),n.realTextareaRef=r.a.createRef(),n.deactivateTextarea=n.deactivateTextarea.bind(Object(l.a)(n)),n.updateScrollTop=n.updateScrollTop.bind(Object(l.a)(n)),n.changeScrolledToBottom=n.changeScrolledToBottom.bind(Object(l.a)(n)),n.props.isMobile&&Rt.is(_t.Android)?n.activateTextarea=n.activateTextareaOnAndroidChrome.bind(Object(l.a)(n)):n.activateTextarea=n.activateTextarea.bind(Object(l.a)(n)),n}return Object(c.a)(a,[{key:"defineMinimalHeight",value:function(){if(this.realTextareaRef.current){var e=parseInt(window.getComputedStyle(this.realTextareaRef.current).getPropertyValue("line-height"),10);this.minimalHeight=isNaN(e)?this.minimalHeight:e}}},{key:"setEqualWidth",value:function(){this.fakeTextareaRef.current&&this.realTextareaRef.current&&(this.fakeTextareaRef.current.style.width="".concat(this.realTextareaRef.current.clientWidth,"px"))}},{key:"calculateCurrentHeight",value:function(){return this.fakeTextareaRef.current&&this.realTextareaRef.current?Math.max(this.fakeTextareaRef.current.clientHeight,this.minimalHeight):this.minimalHeight}},{key:"calculateCurrentFakeRowsNumber",value:function(){if(!this.fakeTextareaRef.current)return this.props.rows;var e=this.calculateCurrentHeight();return Math.ceil(e/this.state.lineHeight)}},{key:"textareaResize",value:function(){if(this.realTextareaRef.current){this.realTextareaRef.current.style.height="auto",this.realTextareaRef.current.style.height="".concat(this.realTextareaRef.current.scrollHeight,"px");var e=this.calculateCurrentFakeRowsNumber(),t=Math.ceil(this.realTextareaRef.current.scrollHeight/this.state.lineHeight);if(e===this.state.rowsBefore&&t===e+1&&1!==e){var a=t;Rt.is(_t.iPhone)&&(a=t>e?e:t),this.setState({rowsBefore:this.state.rowsNow,rowsNow:a,scrollPositionUpdated:Math.random()})}else e===this.state.rowsBefore-1&&t===this.state.rowsBefore?this.setState({rowsBefore:this.state.rowsNow,rowsNow:t,scrollPositionUpdated:Math.random()}):this.setState({rowsBefore:this.state.rowsNow,rowsNow:e,scrollPositionUpdated:Math.random()})}}},{key:"updateTextareaScrollPosition",value:function(){var e=this;this.setState({scrollPositionUpdated:Math.random()},(function(){return e.textareaResize()}))}},{key:"onChange",value:function(e){var t=0===e.target.value.replace(" ","").replace("\n","").length&&e.target.value.length>0,a=0===e.target.value.length;t&&!a||(this.props.controlFunc(e),this.updateTextareaScrollPosition())}},{key:"onPaste",value:function(){this.updateTextareaScrollPosition()}},{key:"checkIfEnter",value:function(e){if("Enter"===e.key){if(!e.shiftKey){var t,a,n;if(e.preventDefault(),0===(null===(t=this.realTextareaRef)||void 0===t||null===(a=t.current)||void 0===a||null===(n=a.value)||void 0===n?void 0:n.length))return;this.props.onPressEnterFunc(e)}this.updateTextareaScrollPosition()}}},{key:"textareaBlur",value:function(e){"hide chat"===e.data&&this.deactivateTextarea()}},{key:"deactivateTextarea",value:function(){this.realTextareaRef.current&&this.realTextareaRef.current.blur()}},{key:"activateTextarea",value:function(){this.realTextareaRef.current&&(this.realTextareaRef.current.blur(),this.realTextareaRef.current.focus())}},{key:"activateTextareaOnAndroidChrome",value:function(){this.realTextareaRef.current&&(this.firstOpenOnAndroidChrome||(this.realTextareaRef.current.blur(),this.realTextareaRef.current.focus()))}},{key:"updateScrollTop",value:function(e){this.setState({scrollTop:e})}},{key:"changeScrolledToBottom",value:function(e){this.setState({scrolledToBottom:e})}},{key:"UNSAFE_componentWillMount",value:function(){var e=this;this.eventEmitterSubscriptions.push(Ee.subscribe("deactivate textarea",this.deactivateTextarea)),this.props.isMobile?this.eventEmitterSubscriptions.push(Ee.subscribe("activate textarea",this.activateTextarea)):this.eventEmitterSubscriptions.push(Ee.subscribe("chat opened",(function(){setTimeout(e.deactivateTextarea,200),setTimeout(e.deactivateTextarea,400),setTimeout(e.deactivateTextarea,600)})))}},{key:"componentDidMount",value:function(){var e;this.setEqualWidth(),this.defineMinimalHeight(),this.chatInterTabBus.addEventListener("message",this.textareaBlur,!1),(null===(e=this.realTextareaRef)||void 0===e?void 0:e.current)&&(this.setState({lineHeight:parseInt(window.getComputedStyle(this.realTextareaRef.current).getPropertyValue("line-height"),10)}),this.props.onRender&&this.props.onRender(this.realTextareaRef.current))}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){this.setEqualWidth(),!this.props.chatIsOpened&&e.chatIsOpened&&setTimeout(this.activateTextarea),this.props.chatIsOpened&&!e.chatIsOpened&&(this.firstOpenOnAndroidChrome=!1)}},{key:"componentDidUpdate",value:function(e){e.content!==this.props.content&&this.textareaResize()}},{key:"componentWillUnmount",value:function(){this.chatInterTabBus.removeEventListener("message",this.textareaBlur,!1),this.eventEmitterSubscriptions.forEach((function(e){return e.unsubscribe()}))}},{key:"getTextareaHeight",value:function(e){return{height:e.lineHeight*e.rowsNow+"px"}}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:Ga.a["form-group"]},r.a.createElement("div",{ref:this.fakeTextareaRef,className:Ga.a["fake-textarea"],dangerouslySetInnerHTML:{__html:this.props.content}}),r.a.createElement("div",{style:{width:"100%",height:this.state.rowsNow>this.props.maxRows?this.state.lineHeight*this.props.maxRows+"px":this.state.lineHeight*this.state.rowsNow+"px",overflow:"hidden"}},r.a.createElement(ba,{scrolledToBottom:!0,scrollToBottom:!0,showScrollAlways:!0,forceUpdate:this.state.scrollPositionUpdated,offset:140,onUpdateScrolledToBottom:this.changeScrolledToBottom,onUpdateScrollTop:this.updateScrollTop,isDefaultEventFlow:!0,slot:r.a.createElement("textarea",{id:"textarea-user-input",ref:this.realTextareaRef,className:Ga.a["form-textarea"],name:this.props.name,rows:1,value:this.props.content,style:Object(f.a)({},this.getTextareaHeight(this.state)),onChange:function(t){return e.onChange(t)},onPaste:function(){return e.onPaste()},onKeyPress:function(t){return e.checkIfEnter(t)},onKeyUp:this.props.onKeyUp,onFocus:function(){return Ee.dispatch("textarea focus")},onBlur:function(){return Ee.dispatch("textarea blur")},placeholder:this.props.placeholder,"data-testid":"TextareaUserInput"})})),r.a.createElement("div",{className:Ga.a["length-counter-wrapper"]},r.a.createElement(Ha,{maxLength:this.props.maxLength,currentLength:this.props.content.length,showAfter:this.props.showAfter})))}}]),a}(r.a.PureComponent),Qa=a(79),Ka=a.n(Qa),Ja=Tt.a.bind(Ka.a),qa=function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).buttonRef=void 0,n.buttonRef=r.a.createRef(),n.onSend=n.onSend.bind(Object(l.a)(n)),n}return Object(c.a)(a,[{key:"onSend",value:function(){this.props.disabled||this.props.onSend()}},{key:"componentDidMount",value:function(){this.buttonRef.current&&(this.buttonRef.current.addEventListener("click",this.onSend,!0),this.buttonRef.current.addEventListener("touchstart",this.onSend,!0))}},{key:"componentWillUnmount",value:function(){this.buttonRef.current&&(this.buttonRef.current.removeEventListener("click",this.onSend,!0),this.buttonRef.current.removeEventListener("touchstart",this.onSend,!0))}},{key:"render",value:function(){var e={"button-send":!0,"can-hover":!(this.props.isMobile||this.props.isTablet),disabled:this.props.disabled};return r.a.createElement("div",{className:Ka.a["button-outer"]},r.a.createElement("div",{ref:this.buttonRef,className:Ja(e),"data-testid":"SendButton"},r.a.createElement("span",{className:Ka.a["button-send__img-orange"]}),r.a.createElement("span",{className:Ka.a["button-send__img-black"]})))}}]),a}(r.a.PureComponent),Va=a(67),Ya=a.n(Va),Za=["chat-dialog-form_attach-files-wrapper","attach-files_attach-file-outer","attach-files_attach-files-label","attach-files_label-icon"],Xa=["chat-dialog-form_button-wrapper","button-send_button-outer","button-send_button-send","button-send_button-send__img-orange","button-send_button-send__img-black"],$a=function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).textAreaRef=void 0,n.containerRef=void 0,n.eventEmitterSubscriptions=[],n.preventBubbling=function(e){e.stopPropagation()},n.saveTextAreaRef=function(e){n.textAreaRef=e},n.onDialogClick=function(e){var t,a=e.target,r=(t=a,!Za.map((function(e){return new RegExp(e).test(t.className)})).reduce((function(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]||(arguments.length>1?arguments[1]:void 0)}))&&!function(e){return Xa.map((function(t){return new RegExp(t).test(e.className)})).reduce((function(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]||(arguments.length>1?arguments[1]:void 0)}))}(a));r&&n.focusTextArea()},n.state={currentMessage:""},n.handleFormSubmit=n.handleFormSubmit.bind(Object(l.a)(n)),n.handleTextareaChange=n.handleTextareaChange.bind(Object(l.a)(n)),n}return Object(c.a)(a,[{key:"handleTextareaChange",value:function(e){"change"===e.type?this.setState({currentMessage:e.target.value}):"paste"===e.type&&this.setState({currentMessage:e.clipboardData.getData("text")}),he.updateCurrentLength(e.target.value.length)}},{key:"handleFormSubmit",value:function(){this.props.userInput.currentLength>this.props.userInput.maxLength||(this.props.handleUserMessage(this.createUserMessage(this.state.currentMessage)),"!form!"===this.state.currentMessage&&Ee.dispatch("open poll form for e2e"),this.setState({currentMessage:""},(function(){Ee.dispatch("form submitted")})))}},{key:"createUserMessage",value:function(e){he.incrementLastMsgId();var t=this.props.parties.find((function(e){return"consumer"===e.type})),a=t?t.party_id:"consumer",n=new Date;return{event:$.Message,msg_id:this.props.chat.lastMsgId.toString(),msg:e,party_id:a,timestamp:JSON.stringify(Math.round(n.getTime()/1e3))}}},{key:"componentDidMount",value:function(){var e;this.props.config.isIPad&&Rt.isBrowser(Mt.Chrome)&&(this.eventEmitterSubscriptions.push(Ee.subscribe("textarea focus",(function(){return Ee.dispatch("add ipad-chrome patch")}))),this.eventEmitterSubscriptions.push(Ee.subscribe("textarea blur",(function(){return Ee.dispatch("remove ipad-chrome patch")}))),this.eventEmitterSubscriptions.push(Ee.subscribe("deactivate textarea",(function(){return Ee.dispatch("remove ipad-chrome patch")})))),(null===(e=this.containerRef)||void 0===e?void 0:e.current)&&this.containerRef.current.addEventListener("touchmove",this.preventBubbling)}},{key:"componentDidUpdate",value:function(e,t){}},{key:"componentWillUnmount",value:function(){var e;this.eventEmitterSubscriptions.forEach((function(e){return e.unsubscribe()})),(null===(e=this.containerRef)||void 0===e?void 0:e.current)&&this.containerRef.current.removeEventListener("touchmove",this.preventBubbling)}},{key:"focusTextArea",value:function(){if(!this.textAreaRef)throw Error("".concat(this.textAreaRef," is not textarea native element"));this.textAreaRef.blur(),this.textAreaRef.focus()}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{onClick:this.onDialogClick,onTouchEnd:this.onDialogClick,ref:this.containerRef,className:Ya.a["chat-dialog-form"]},r.a.createElement("form",{method:"post",name:"chat-dialog-form",className:Ya.a["chat-dialog-form__form"],onSubmit:function(){return e.handleFormSubmit()},"data-testid":"DialogForm"},r.a.createElement(za,{rows:1,maxRows:9,name:"message-textarea",autoResize:!0,placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435...",content:this.state.currentMessage,controlFunc:this.handleTextareaChange,onPressEnterFunc:this.handleFormSubmit,onRender:this.saveTextAreaRef,onKeyUp:this.props.onTextAreaKeyUp,chatIsOpened:this.props.chatIsOpenedLocalState,maxLength:this.props.userInput.maxLength,showAfter:this.props.userInput.showAfter,isMobile:this.props.config.isMobile}),r.a.createElement("div",{className:Ya.a["button-placeholder"]}),this.props.config.unsupportedDevice?null:r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:Ya.a["attach-files-wrapper"]},this.props.attachFiles),r.a.createElement("div",{className:Ya.a["button-wrapper"]},r.a.createElement(qa,{disabled:0===this.state.currentMessage.length||this.props.userInput.currentLength>this.props.userInput.maxLength,isMobile:this.props.config.isMobile,isTablet:this.props.config.isTablet,onSend:this.handleFormSubmit})))))}}]),a}(r.a.PureComponent),en=ue((function(e){return{chat:e.chat,parties:e.parties,config:e.config,userInput:e.userInput}}))($a),tn=a(13),an=a.n(tn),nn=Tt.a.bind(an.a),rn=function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).bubbleRef=void 0,n.state={clearedMsg:"",bubbleHeight:0},n.bubbleRef=r.a.createRef(),n}return Object(c.a)(a,[{key:"componentDidMount",value:function(){var e=this.props.event.msg?this.props.event.msg:"";e=Ot(e),this.setState({clearedMsg:e})}},{key:"componentDidUpdate",value:function(e,t){var a=this;if(this.bubbleRef&&this.bubbleRef.current){var n=this.bubbleRef.current.getBoundingClientRect().height;n!==this.state.bubbleHeight&&this.setState({bubbleHeight:n},(function(){a.props.onDidUpdate(a.props.dataKey,n)}))}}},{key:"componentWillUnmount",value:function(){this.props.onDidUpdate(this.props.dataKey,this.state.bubbleHeight,!0)}},{key:"processTime",value:function(e){if(!e)return"";var t=Et(e),a=t[0];return"today"===t[2]?"".concat(a.hours,":").concat(a.minutes):"yesterday"===t[2]?"\u0432\u0447\u0435\u0440\u0430,<br />".concat(a.hours,":").concat(a.minutes):["this month","this year"].includes(t[2])?"".concat(a.day,".").concat(a.month,",<br />").concat(a.hours,":").concat(a.minutes):"".concat(a.day,".").concat(a.month,".").concat(a.year,",<br />").concat(a.hours,":").concat(a.minutes)}},{key:"systemMessage",value:function(e){switch(e){case"joined":return r.a.createElement("div",{className:an.a["system-message"]},"\u041d\u0430 \u0412\u0430\u0448 \u0437\u0430\u043f\u0440\u043e\u0441 \u043e\u0442\u0432\u0435\u0447\u0430\u0435\u0442 \u043a\u043e\u043d\u0441\u0443\u043b\u044c\u0442\u0430\u043d\u0442",this.props.event.display_name?" "+this.props.event.display_name:"",".");case"leave":return r.a.createElement("div",{className:an.a["system-message"]},"\u041a\u043e\u043d\u0441\u0443\u043b\u044c\u0442\u0430\u043d\u0442 \u0432\u044b\u0448\u0435\u043b \u0438\u0437 \u0447\u0430\u0442\u0430.");case"ended":return r.a.createElement("div",{className:an.a["system-message"]},"\u0427\u0430\u0442 \u0437\u0430\u0432\u0435\u0440\u0448\u0451\u043d.");case"system":return""===this.state.clearedMsg?null:r.a.createElement("div",{className:an.a["system-message"]},this.state.clearedMsg);case"inactivity":case"disconnect":case"timeout":return r.a.createElement("div",{className:an.a["system-message"]},this.state.clearedMsg);case"start":return r.a.createElement("div",{className:nn(an.a["system-message"],an.a["start-message"])},this.state.clearedMsg)}}},{key:"fileMessage",value:function(){var e=this.props.event,t=e.file_name,a=e.file_id,n=e.inQuery,s=e.party_id,i=e.session_id;if(/hide_file$/.test(String(t)))return"";var o=i||this.props.chat_id,c=lt(t,15),l=this.props.archive||this.props.disconnected||this.props.event.msg&&this.props.event.msg.includes(W),u=rt(t),h=this.props.parties.find((function(e){return e.party_id===s})),d=h?h.type:"consumer",p=u?'<a target="_blank" href="https://tsum.hostedcc.ru/clientweb/api/v1/chats/'.concat(o,"/files/").concat(a,'" style="display: block;"><img style="display: block; max-width: 200px; max-height: 120px; background: #fff; border: 1px solid #666; margin: 0 0 4px 0;" src="https://tsum.hostedcc.ru/clientweb/api/v1/chats/').concat(o,"/files/").concat(a,'" alt="').concat(t,'"></a>'):'\u0421\u043a\u0430\u0447\u0430\u0442\u044c \u0444\u0430\u0439\u043b &laquo;<a download target="_blank" href="https://tsum.hostedcc.ru/clientweb/api/v1/chats/'.concat(o,"/files/").concat(a,'">').concat(c,"</a>&raquo;."),f=l?"\u0411\u044b\u043b \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u0435\u043d \u0444\u0430\u0439\u043b &laquo;".concat(c,"&raquo;."):p,v=n?"\u041e\u0442\u043f\u0440\u0430\u0432\u043b\u044f\u044e \u0444\u0430\u0439\u043b &laquo;".concat(c,"&raquo; ... "):f;!l&&u&&(new Image).setAttribute("src","https://tsum.hostedcc.ru/clientweb/api/v1/chats/".concat(o,"/files/").concat(a));return r.a.createElement("div",{className:nn(an.a["talk-bubble-outer"],an.a["talk-bubble-outer__".concat(d)])},r.a.createElement("div",{className:an.a.avatar},r.a.createElement("img",{src:["operator","tsum"].includes(d)?this.props.chatHeader.avatarPath:this.props.chatHeader.userAvatar,alt:""})),r.a.createElement("div",{className:an.a["talk-bubble"]},r.a.createElement("div",{className:an.a["talk-bubble__message"],dangerouslySetInnerHTML:{__html:v}}),r.a.createElement("div",{className:an.a.pip},r.a.createElement("div",{className:an.a.circle}))),r.a.createElement("div",{className:an.a.time,dangerouslySetInnerHTML:{__html:this.processTime(this.props.event.timestamp)}}))}},{key:"messageEvent",value:function(){var e=this,t=this.state.clearedMsg;if(!t)return"";var a=this.props.parties.find((function(t){return t.party_id===e.props.event.party_id})),n=a?a.type:this.props.event.party_id;return this.props.event.localUserMessage&&(t=jt(t)),"operator"===n&&(/(?:<a( ?[\w]*=("|'){1}[^"']*\2)*>)|&lt;a( +[\w]+=("|'){1}[^"']*\4)*&gt;|<\/a>|&lt;\/a&gt;/g.test(t)||(t=jt(t))),r.a.createElement("div",{className:nn(an.a["talk-bubble-outer"],an.a["talk-bubble-outer__".concat(n)])},r.a.createElement("div",{className:an.a.avatar},r.a.createElement("img",{src:["operator","tsum"].includes(n||"")?this.props.chatHeader.avatarPath:this.props.chatHeader.userAvatar,alt:""})),r.a.createElement("div",{className:an.a["talk-bubble"]},r.a.createElement("div",{className:an.a["talk-bubble__message"],dangerouslySetInnerHTML:{__html:t}}),r.a.createElement("div",{className:an.a.pip},r.a.createElement("div",{className:an.a.circle}))),r.a.createElement("div",{className:an.a.time,dangerouslySetInnerHTML:{__html:this.processTime(this.props.event.timestamp)}}))}},{key:"endOfSession",value:function(){return null}},{key:"showDate",value:function(e){if(!e)return"";var t=Et(e),a=t[0];return"today"===t[2]?"\u0437\u0430 \u0441\u0435\u0433\u043e\u0434\u043d\u044f, ".concat(a.hours,":").concat(a.minutes):"yesterday"===t[2]?"\u0437\u0430 \u0432\u0447\u0435\u0440\u0430, ".concat(a.hours,":").concat(a.minutes):["this month","this year"].includes(t[2])?"\u0437\u0430 ".concat(a.day,".").concat(a.month,", ").concat(a.hours,":").concat(a.minutes):"\u0437\u0430 ".concat(a.day,".").concat(a.month,".").concat(a.year,", ").concat(a.hours,":").concat(a.minutes)}},{key:"processMessage",value:function(){var e=this;if(this.props.event.msg&&(this.props.event.msg.includes(G)||z.test(this.props.event.msg)||Q.test(this.props.event.msg)))return"";var t=this.props.event.event,a=this.props.parties.find((function(t){return t.party_id===e.props.event.party_id})),n=a?a.type:this.props.event.party_id;return this.props.event.msg&&function(e,t){var a,n=Object(ke.a)(e);try{for(n.s();!(a=n.n()).done;){var r=a.value;if("string"!==typeof r)return r.test(t);if(t.indexOf(r)>-1)return!0}}catch(bn){n.e(bn)}finally{n.f()}return!1}(J,this.props.event.msg)&&(n="tsum"),t===$.Message?this.props.startMessage?this.systemMessage("start"):"tsum"===n?this.systemMessage("system"):this.messageEvent():t===$.PartyJoined?this.systemMessage("joined"):t===$.PartyLeft?this.systemMessage("leave"):t===$.Disconnect?this.systemMessage("disconnect"):t===$.TimeoutWarning?this.systemMessage("timeout"):t===$.InactivityTimeout?this.systemMessage("inactivity"):t===$.Ended?this.endOfSession():t===$.File?this.fileMessage():""}},{key:"render",value:function(){return r.a.createElement("div",{className:an.a["talk-bubble-wrapper"],ref:this.bubbleRef},this.processMessage())}}]),a}(r.a.PureComponent),sn=ue((function(e){return{parties:e.parties,chatHeader:e.chatHeader}}))(rn),on=a(102),cn=a.n(on),ln=function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).eventEmitterSubscriptions=[],n.defaultMessage="\u0417\u0430\u0434\u0430\u0439\u0442\u0435 \u0432\u043e\u043f\u0440\u043e\u0441 \u043a\u043e\u043d\u0441\u0443\u043b\u044c\u0442\u0430\u043d\u0442\u0443 \u0426\u0423\u041c\u0430",n.displayedMessages$=new Bt.a({}),n.displayedMessagesAsObservable$=n.displayedMessages$.asObservable(),n.destroyed$=new Pt.a,n.state={eventsUpdated:0,displayedMessages:{},scrolledToBottom:!0,scrollTop:0},n.updateScrollbar=n.updateScrollbar.bind(Object(l.a)(n)),n.onUpdated=n.onUpdated.bind(Object(l.a)(n)),n.changeScrolledToBottom=n.changeScrolledToBottom.bind(Object(l.a)(n)),n.updateScrollTop=n.updateScrollTop.bind(Object(l.a)(n)),n}return Object(c.a)(a,[{key:"changeScrolledToBottom",value:function(e){this.setState({scrolledToBottom:e})}},{key:"checkEventType",value:function(e){return[$.PartyJoined,$.PartyLeft,$.Message,$.File,$.TimeoutWarning,$.InactivityTimeout,$.Disconnect,$.Ended].includes(e.event)}},{key:"updateScrollbar",value:function(){this.setState({eventsUpdated:Math.random()})}},{key:"updateScrollTop",value:function(e){this.setState({scrollTop:e})}},{key:"onUpdated",value:function(e,t,a){if(a){var n=Object(f.a)({},this.displayedMessages$.getValue());e in n&&delete n[e],this.displayedMessages$.next(n)}else this.displayedMessages$.next(Object(f.a)(Object(f.a)({},this.displayedMessages$.getValue()),{},Object(v.a)({},e,t)))}},{key:"componentDidMount",value:function(){var e=this;this.eventEmitterSubscriptions.push(Ee.subscribe("events updated",this.updateScrollbar)),this.displayedMessagesAsObservable$.pipe(Object(Vt.a)(50),Object(Re.a)((function(t){e.setState({displayedMessages:t,eventsUpdated:Math.random()})})),Object(Xt.a)(this.destroyed$)).subscribe()}},{key:"componentWillUnmount",value:function(){this.eventEmitterSubscriptions.forEach((function(e){return e.unsubscribe()})),this.destroyed$.next(),this.destroyed$.complete()}},{key:"render",value:function(){var e=this,t=0===this.props.chat.archive.length&&0===this.props.chat.events.length,a=this.props.chat.archive.length>0?r.a.createElement(r.a.Fragment,null,this.props.chat.archive.map((function(t,a){return e.checkEventType(t)?r.a.createElement(sn,{key:a,dataKey:"archive_"+a,event:t,chatGlobalSetting:e.props.chatGlobalSetting,archive:!0,onDidUpdate:e.onUpdated}):""}))):null;return r.a.createElement("div",{className:cn.a.dialog},r.a.createElement("div",{className:cn.a["dialog-inner"]},r.a.createElement(ba,{forceUpdate:this.state.eventsUpdated,scrollToBottom:!0,scrolledToBottom:this.state.scrolledToBottom,scrollTop:this.state.scrollTop,onUpdateScrolledToBottom:this.changeScrolledToBottom,onUpdateScrollTop:this.updateScrollTop,slot:r.a.createElement("div",{className:cn.a["messages-wrapper"]},t?r.a.createElement(sn,{key:"default-message",dataKey:"default-message",event:{event:$.Message,msg:this.defaultMessage,party_id:"tsum"},chatGlobalSetting:this.props.chatGlobalSetting,archive:!0,startMessage:!0,onDidUpdate:this.onUpdated}):null,a,this.props.chat.events.map((function(t,a){return e.checkEventType(t)?r.a.createElement(sn,{key:a,dataKey:"events_"+a,chat_id:e.props.chat.chat_id,event:t,chatGlobalSetting:e.props.chatGlobalSetting,disconnected:["disconnected","not connected"].includes(e.props.chat.status),archive:!1,onDidUpdate:e.onUpdated}):""})))})))}}]),a}(r.a.PureComponent),un=a(48),hn=a.n(un),dn=function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).typingNotifyRef=r.a.createRef(),n.footerRef=void 0,n.chatRef=void 0,n.tabId="",n.userEventsSent=!1,n.defaultDelay=3,n.stopFlow$=new Pt.a,n.chatSubject$=new Bt.a(n.props.chat),n.chat$=n.chatSubject$.asObservable(),n.chatPause$=new Bt.a(!1),n.chatInited=!1,n.gettingActiveChat=!1,n.fileArray=[],n.fileEvents=[],n.eventEmitterSubscriptions=[],n.customHeaders={},n.cooldown=0,n.chatId$=new Bt.a(null),n.userInput$=new Pt.a,n.userTypingThread=0,n.userEventSubscription=n.userInput$.pipe(Object(Qt.a)((function(){return Object(Ht.a)([n.chatPause$,n.chatId$]).pipe(Object(Kt.a)((function(e){var t=Object(y.a)(e,2),a=t[0],n=t[1];return!a&&!!n})),Object(Qt.a)((function(){return n.sendQuery().pipe(Object(Jt.a)((function(e){return function(e,t,a){for(var n=e.length,r=a.events.length,s=Object(w.a)(a.events),i=0;i<n;i++)for(var o=r-1;o>=0;o--)if(_()(e[i],s[o])){s[o].inQuery=t;break}he.setChat({events:s})}(e,!1,n.props.chat)})))})))}))).subscribe(),n.onTyping=function(e){"enter"!==e.key.toLowerCase()?(n.sendTypingEvent(),clearTimeout(n.userTypingThread),n.userTypingThread=window.setTimeout((function(){n.sendNotTypingEvent()}),a.UserTypingThrottle)):n.sendNotTypingEvent()},n.sendNotTypingEvent=function(){n.props.chat.chat_id&&n.sendEvents([{event:$.NotTyping}]).pipe(Object(qt.a)((function(e){return Wt.a}))).subscribe()},n.state={repeatRequestForChat:0,typing:!1,showDropZone:!1},window.onbeforeunload=function(){n.sendNotTypingEvent(),n.sleep(a.LeavingDelay)},n.footerRef=r.a.createRef(),n.chatRef=r.a.createRef(),n.handleUserMessage=n.handleUserMessage.bind(Object(l.a)(n)),n.handleUserFiles=n.handleUserFiles.bind(Object(l.a)(n)),n.checkAvailability=n.checkAvailability.bind(Object(l.a)(n)),n.connectToChat=n.connectToChat.bind(Object(l.a)(n)),n.reInitChat=n.reInitChat.bind(Object(l.a)(n)),n.typingDetection=n.typingDetection.bind(Object(l.a)(n)),n.getNewChatEvents=n.getNewChatEvents.bind(Object(l.a)(n)),n.onBeforeUnload=n.onBeforeUnload.bind(Object(l.a)(n)),n.onFirstConnect=n.onFirstConnect.bind(Object(l.a)(n)),n.onSessionTerminated=n.onSessionTerminated.bind(Object(l.a)(n)),n.onDragEnter=n.onDragEnter.bind(Object(l.a)(n)),n.hideDropZone=n.hideDropZone.bind(Object(l.a)(n)),n.receiveMsg=n.receiveMsg.bind(Object(l.a)(n)),n.toShowPoll=n.toShowPoll.bind(Object(l.a)(n)),n.sendEvents=n.sendEvents.bind(Object(l.a)(n)),n}return Object(c.a)(a,[{key:"checkAvailability",value:function(){return Se.checkAvailability(this.customHeaders)}},{key:"connectToChat",value:function(){var e,t=localStorage.getItem("uuid");t&&-1!==t.indexOf('"')&&(t=t.replace(/"/g,""));var a={phone_number:"",parameters:{cookie_id:t,first_name:"",last_name:"",email:"",deviceType:this.props.chatGlobalSetting.ABSOLUTE_URL?It.IOS:It.WEB,breadcrumbs:(null===(e=this.props.config.breadcrumbs)||void 0===e?void 0:e.join(" / "))||"\u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c \u043d\u0435 \u0432 \u043a\u0430\u0442\u0430\u043b\u043e\u0433\u0435",screen:this.props.config.screen||"",referer:this.props.chatGlobalSetting.ABSOLUTE_URL||this.props.chatGlobalSetting.REFERER||""}};return Se.getChat(a,this.customHeaders)}},{key:"getChatHistory",value:function(e){return Se.getHistory(this.props.chat.chat_id||e,this.customHeaders)}},{key:"getActiveChat",value:function(){return this.customHeaders.Authorization||this.defineHeaders(),Se.getActiveChat(this.customHeaders)}},{key:"getNewChatEvents",value:function(e){return e?Se.getEvents(e,this.customHeaders):Object(Te.a)("\u041d\u0435 \u043f\u0440\u0438\u0448\u0435\u043b chatId.")}},{key:"sendQuery",value:function(e){var t=e?e.filter((function(e){return e.inQuery})):this.props.chat.events.filter((function(e){return e.inQuery}));return Se.sendEvents(this.props.chat.chat_id,t,this.customHeaders).pipe(Object(Jt.a)((function(){return t})))}},{key:"sendEvents",value:function(e){return Se.sendEvents(this.props.chat.chat_id,e,this.customHeaders)}},{key:"sendFile",value:function(e){return Se.sendFile(e,this.customHeaders)}},{key:"onSessionTerminated",value:function(){var e;this.userEventsSent=!1,this.chatInited=!1,function(e){var t=e.length,a={event:$.Ended,timestamp:Date.now().toString()};if(t>0){if(e[t-1].event===$.Ended)return;for(var n=t-1;n>=0;n--)if(e[n].timestamp){a.timestamp=e[n].timestamp;break}}he.updateEvents([].concat(Object(w.a)(e),[a]))}(this.props.chat.events),Xe(this.props.chat.events),this.props.chat.currentStep===X.Poll&&he.setCurrentStep(X.Dialog),this.stopFlow$.next(),this.chatId$.next(null),he.setChat({sessionTerminated:!0,chat_id:"",state:"",status:"disconnected",lastMsgId:0}),he.clearStopWords(),this.setState({typing:!1},null===(e=this.typingNotifyRef.current)||void 0===e?void 0:e.cancelTypingPointsAnimation),Ee.dispatch("session started",{type:"session started",data:!1})}},{key:"toShowPoll",value:function(e){try{var t=this.props.chat.lastActivity,a=this.resultState(X.Poll,new Date(t),new Date,0),n=e.filter((function(e){return e.event===$.PollShowed}));if(Boolean(n.length>0)){var r=n[0],s=r.form_request_id,i=r.form_name;he.setCurrentStep(a),he.setPollFormData({id:s,name:i})}}catch(o){console.error(o)}}},{key:"runFlow",value:function(){var e=this;if(!this.chatInited){this.chatInited=!0;var t=function(t){var a=e.getNewChatEvents(t).pipe(Object(Jt.a)(We),Object(Re.a)(e.toShowPoll),Object(Jt.a)((function(t){return nt(t,e.props.parties)})),Object(Jt.a)((function(t){return bt(t,e.props.chat.archive,e.props.parties,e.props.chat.chat_id,e.sendEvents)})),Object(Jt.a)((function(e){return gt(e)})),Object(Re.a)((function(t){return yt(t,e.props.stopWords,e.sendEvents)})),Object(Jt.a)((function(e){return at(e)})),Object(Jt.a)(ze),Object(Jt.a)((function(e){return ft(e)})),Object(Jt.a)((function(e){return vt(e)})),Object(Jt.a)((function(t){return ht(t,e.props.chat)})),Object(Re.a)((function(t){return function(e,t,a){var n=Be(pt).once(),r=e.filter((function(e){return e.event===$.Message}));if(0!==r.length){var s,i=Object(ke.a)(r);try{var o=function(){var e=s.value;if(!e.party_id)return"continue";var r=a.find((function(t){return t.party_id===e.party_id}));if(!r)return"continue";if(r&&"operator"!==r.type)return"continue";var i=t.events.filter((function(e){return e.party_id===r.party_id&&e.event===$.Message&&""!==e.msg}));1===i.length&&n()};for(i.s();!(s=i.n()).done;)o()}catch(bn){i.e(bn)}finally{i.f()}}}(t,e.props.chat,e.props.parties)})),Object(Re.a)((function(t){return Ve(t,e.props.chat,e.props.parties)})),Object(Re.a)(e.typingDetection),Object(Re.a)((function(t){return function(e,t,a){if(t.chatIsOpened)return t.newMessages>0&&(he.setChat({newMessages:0}),Ee.dispatch("new messages",{type:"new messages",data:0})),e;if(0===e.length)return e;for(var n=e.filter((function(e){return[$.Message,$.File].includes(e.event)})),r=a.filter((function(e){return"operator"===e.type})),s=[],i=0;i<r.length;i++)s.push(r[i].party_id);return(n=n.filter((function(e){return!!e.party_id&&s.includes(e.party_id)}))).length>0&&(he.setChat({newMessages:t.newMessages+n.length}),Ee.dispatch("new messages",{type:"new messages",data:t.newMessages+n.length})),e}(t,e.props.chat,e.props.parties)})),Object(Re.a)((function(t){return Ze(t,e.onSessionTerminated,e.props.chat.newMessages)})),Object(Vt.a)(1e3),Object(Yt.a)(),Object(Zt.a)((function(t){return function(e,t,a){return e.pipe(Object(xe.a)(1e3*t),Object(Re.a)((function(e){e instanceof Ae||de(e,"status")&&404===e.status&&a()})))}(t,e.defaultDelay,e.onSessionTerminated)})),Object(qt.a)((function(){return e.chatSubject$.next(e.props.chat),Wt.a})));return e.chatPause$.pipe(Object(Qt.a)((function(e){return e?Gt.a:a})))};this.chat$.pipe(Object(Qt.a)((function(){return e.checkAvailability().pipe(Object(Qt.a)(Je),Object(Zt.a)((function(t){return ct(t,e.defaultDelay,e.onSessionTerminated,e.reInitChat)})))})),Object(Qt.a)((function(){return e.connectToChat().pipe(Object(Qt.a)(qe),Object(Zt.a)((function(t){return ct(t,e.defaultDelay,e.onSessionTerminated,e.reInitChat)})))})),Object(Jt.a)((function(e){return he.setChat({chat_id:e.response.chat_id}),e.response.chat_id})),Object(Re.a)((function(t){return e.chatId$.next(t)})),Object(Re.a)((function(t){return function(e,t,a,n){if(!function(e,t){return t.some((function(t){return t.party_id===e}))}(n||a,t)){var r={party_id:n||a};he.addParty(He(r,e,a))}}("consumer",e.props.parties,t)})),Object(Jt.a)((function(t){if(0===e.fileArray.length)return t;var a=e.prepareFilesDraft(t),n=a.fileArray,r=a.fileEvents,s=a.updatedChat;return e.sendFilesDraft(n,r,s,!0),t})),Object(Qt.a)((function(t){return e.getNewChatEvents(t).pipe(Object(Jt.a)(We),Object(Re.a)(e.toShowPoll),Object(Jt.a)((function(e){return function(e){return 0===e.length?e:e.filter((function(e){return e.event!==$.PartyLeft}))}(e)})),Object(Jt.a)((function(t){return bt(t,e.props.chat.archive,e.props.parties,0,e.sendEvents)})),Object(Jt.a)((function(e){return gt(e)})),Object(Re.a)((function(t){return yt(t,e.props.stopWords,e.sendEvents)})),Object(Jt.a)((function(t){return nt(t,e.props.parties)})),Object(Jt.a)((function(t){return function(e,t){if(0===e.length)return e;if(t.chatIsOpened)return e;var a=e.filter((function(e){return[$.Message].includes(e.event)})).length+t.newMessages,n=Object(f.a)(Object(f.a)({},t),{},{newMessages:a});return Ee.dispatch("new messages",{type:"new messages",data:a}),he.updateChat(n),e}(t,e.props.chat)})),Object(Jt.a)(ze),Object(Jt.a)((function(e){return ft(e)})),Object(Jt.a)((function(e){return vt(e)})),Object(Jt.a)((function(t){return ht(t,e.props.chat)})),Object(Re.a)((function(t){return Ve(t,e.props.chat,e.props.parties)})),Object(Re.a)((function(t){return Ze(t,e.onSessionTerminated,e.props.chat.newMessages)})),Object(Qt.a)((function(){return e.onFirstConnect(t)})),Object(Zt.a)((function(t){return ct(t,e.defaultDelay,e.onSessionTerminated,e.reInitChat)})))})),Object(Qt.a)((function(t){return e.getChatHistory(t).pipe(Object(Jt.a)(We),Object(Re.a)(e.toShowPoll),Object(Jt.a)((function(t){return nt(t,e.props.parties)})),Object(Re.a)(e.clearEvents),Object(Jt.a)((function(e){return function(e){if(0===e.length)return e;var t,a=[],n=!1,r=Object(ke.a)(e);try{for(r.s();!(t=r.n()).done;){var s=t.value;"connected"===s.state&&(n=!0),(n||s.event!==$.PartyLeft)&&a.push(s)}}catch(bn){r.e(bn)}finally{r.f()}return a}(e)})),Object(Jt.a)((function(e){return at(e)})),Object(Jt.a)(ze),Object(Jt.a)((function(t){return ht(t,e.props.chat)})),Object(Re.a)((function(t){return Ve(t,e.props.chat,e.props.parties)})),Object(Re.a)((function(t){return Ze(t,e.onSessionTerminated,e.props.chat.newMessages)})),Object(Jt.a)((function(){return t})),Object(qt.a)((function(t){return de(t,"response","status")&&404===t.response.status&&e.onSessionTerminated(),Wt.a})))})),Object(Qt.a)((function(e){return t(e)})),Object(Xt.a)(this.stopFlow$)).subscribe()}}},{key:"onFirstConnect",value:function(e){var t=this,a=function(e){for(var t=e.length,a=0;a<t;a++){if(e[a].event===$.Status&&"connected"===e[a].state)return!0;if(e[a].event===$.PartyJoined)return!0}return!1}(this.props.chat.events);return this.userEventsSent?a?(he.setChat({sessionTerminated:!1,status:"connected"}),Object(Me.a)(e)):Object(Te.a)(new Ae({text:"Still waiting for operator."})):(this.userEventsSent=!0,Ye({url:this.props.config.url,title:this.props.config.title,breadcrumbs:this.props.config.breadcrumbs,screen:this.props.config.screen,absoluteUrl:this.props.chatGlobalSetting.ABSOLUTE_URL},this.props.chat,this.props.config.origin,this.customHeaders).pipe(Object($t.a)((function(){return t.sendQuery()})),Object(Re.a)((function(){return function(e){for(var t=Object(f.a)({},e),a=e.events,n=a.length,r=!1,s=0;s<n;s++)a[s].inQuery&&(a[s].inQuery=!1,r=!0);r&&(t=Object(f.a)(Object(f.a)({},t),{},{events:a}),he.setChat(t))}(t.props.chat)})),Object(ea.a)(a?Object(Me.a)(e):Object(Te.a)(new Ae({text:"Can not send current user's page or query of users events.",type:"user events sending"})))))}},{key:"clearEvents",value:function(){he.clearEvents()}},{key:"typingDetection",value:function(e){var t,a=this,n=e.filter((function(e){return[$.Typing,$.NotTyping].includes(e.event)}));return 0===n.length?(this.setState({typing:!1},null===(t=this.typingNotifyRef.current)||void 0===t?void 0:t.cancelTypingPointsAnimation),e):(this.setState({typing:n[n.length-1].event===$.Typing},(function(){var e,t;a.state.typing?null===(e=a.typingNotifyRef.current)||void 0===e||e.startTypingPointsAnimation():null===(t=a.typingNotifyRef.current)||void 0===t||t.cancelTypingPointsAnimation()})),e)}},{key:"handleUserMessage",value:function(e){var t,a=this,n=Object(f.a)({},e),r=function(e,t){if(0===t.length)return!1;for(var a=t.length,n=Date.now(),r=Date.now()-864e5,s=a-1;s>=0;s--)if(t[s].timestamp&&t[s].event===$.Ended){if(r=parseInt(t[s].timestamp,10),n.toString().length-r.toString().length>=3){r*=1e3;break}break}return n-r<1e3*e}(this.cooldown,this.props.chat.archive);Ee.dispatch("user sent message"),n.msg=(t=n.msg)?Ie(t):"",r?he.archiveEvents([n]):(n.inQuery=!0,n.localUserMessage=!0,["disconnected","not connected"].includes(this.props.chat.status)&&this.reInitChat(),he.updateEvents([n]).then((function(){return a.userInput$.next()})))}},{key:"handleUserFiles",value:function(e){if(Ee.dispatch("user sent message"),!this.props.chat.chat_id)return this.makeFilesDraft(e),void this.reInitChat();for(var t=e.length,a=[],n=[],r=0;r<t;r++)a.push(e[r]),n.push(ut(e[r],this.props.chat.chat_id,Ke("consumer",this.props.parties)));var s=Object(f.a)(Object(f.a)({},this.props.chat),{},{events:[].concat(Object(w.a)(this.props.chat.events),n)});this.sendFilesDraft(a,n,s)}},{key:"requestForTerminateSession",value:function(e){var t=this,a=this.props.parties.find((function(e){return"consumer"===e.type})),n=a?a.party_id:"consumer",r=new Date,s={inQuery:!0,event:$.End,party_id:n,timestamp:JSON.stringify(Math.round(r.getTime()/1e3))};he.updateEvents([s]).then((function(){t.userInput$.next(),e&&e()}))}},{key:"makeFilesDraft",value:function(e){for(var t=e.length,a=0;a<t;a++)this.fileArray.push(e[a]),this.fileEvents.push(ut(e[a],"",Ke("consumer",this.props.parties)));he.setChat({events:[].concat(Object(w.a)(this.props.chat.events),Object(w.a)(this.fileEvents))})}},{key:"prepareFilesDraft",value:function(e){for(var t=Object(w.a)(this.props.chat.events),a=this.fileEvents.length,n=0;n<a;n++){var r=Qe({event:$.File,file_name:this.fileEvents[n].file_name,inQuery:!0},t);-1!==r&&(t[r].session_id=e)}he.setChat({events:Object(w.a)(t)});var s=Object(f.a)(Object(f.a)({},this.props.chat),{},{events:Object(w.a)(t)});return{fileArray:this.fileArray,fileEvents:this.fileEvents,updatedChat:s}}},{key:"sendFilesDraft",value:function(e,t,a){var n=this,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=[];e.forEach((function(e,r){t[r].event===$.File?s.push(n.sendFile(e).pipe(Object(Jt.a)((function(e){return st(e,a)})),Object(Zt.a)((function(e){return e.pipe(Object(xe.a)(1e3),Object(Ce.a)(3))})),Object(qt.a)((function(){return Wt.a})))):s.push(Object(Me.a)(t[r]))})),Object(zt.a)(s).pipe(Object(Qt.a)((function(e){var t=e.filter((function(e){return""!==e.file_name}));return it(t,a),n.sendQuery(t).pipe(Object(Jt.a)((function(){return ot(t,a)})),Object(Zt.a)((function(e){return ct(e,n.defaultDelay,n.onSessionTerminated,n.reInitChat)})))}))).subscribe((function(){r&&(n.fileEvents=[],n.fileArray=[])}))}},{key:"reInitChat",value:function(){this.chatPause$.next(!1),this.chatSubject$=new Bt.a(this.props.chat),this.chat$=this.chatSubject$.asObservable(),this.runFlow(),Ee.dispatch("session started",{type:"session started",data:!0})}},{key:"onBeforeUnload",value:function(){this.stopFlow$.next()}},{key:"onDragEnter",value:function(){this.setState({showDropZone:!0})}},{key:"hideDropZone",value:function(){this.setState({showDropZone:!1})}},{key:"checkIfSessionIsAlive",value:function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.gettingActiveChat||(this.gettingActiveChat=!0,this.getActiveChat().pipe(Object(Re.a)((function(){e.chatInited?(e.chatInited=!1,e.stopFlow$.next(),e.reInitChat(),Ee.dispatch("session started",{type:"session started",data:!0})):(t?e.reInitChat():e.runFlow(),Ee.dispatch("session started",{type:"session started",data:!0})),e.gettingActiveChat=!1})),Object(qt.a)((function(){return e.chatPause$.next(!0),e.onSessionTerminated(),e.gettingActiveChat=!1,Ee.dispatch("session started",{type:"session started",data:!1}),Wt.a}))).subscribe())}},{key:"receiveMsg",value:function(e){de(e,"data","type")&&e.origin===this.props.chatGlobalSetting.ORIGIN&&["navigation"].includes(e.data.type)&&"connected"===this.props.chat.status&&"navigation"===e.data.type&&(Ee.dispatch("navigation",{type:"navigation",data:e.data}),Ye(e.data.data,this.props.chat,this.props.config.origin,this.customHeaders).subscribe())}},{key:"preventFooterTouchmove",value:function(e){Ge(e)}},{key:"defineHeaders",value:function(){var e=M.getFeature("config"),t=this.props.config.appId?this.props.config.appId:e.appId;this.customHeaders.Authorization='MOBILE-API-140-327-PLAIN appId="'.concat(t,'", clientId="').concat(localStorage.getItem("uuid"),'"')}},{key:"componentDidMount",value:function(){var e=this,t=M.getFeature("chat");!function(e){if(!(e.length<200)){var t=Object(w.a)(e),a=M.getStoreAsString();if(!(a.length<12e5)){var n=12e5-(a.length-JSON.stringify(t).length);if(!(n<=0)){for(;JSON.stringify(t).length>n;)t.splice(0,5);he.setChat({archive:t})}}}}(this.props.chat.archive),this.userEventsSent=!1,0===this.props.chat.events.length&&(this.props.chat.lastMsgId>0||this.props.chat.newMessages>0)&&he.setChat({lastMsgId:0,newMessages:0}),t&&!t.chatIsOpened&&Ee.dispatch("new messages",{type:"new messages",data:t.newMessages}),this.footerRef.current&&this.footerRef.current.addEventListener("touchmove",this.preventFooterTouchmove),this.props.chat.chatIsOpened&&!this.props.chatIsOpenedLocalState&&Ee.dispatch("command",{type:"command",data:"start chat"}),["disconnected","not connected"].includes(this.props.chat.status)||this.checkIfSessionIsAlive(!1),this.tabId=Date.now().toString()+"__"+Math.round(1e6*Math.random()).toString(),he.setActiveTab(this.tabId),window.addEventListener("beforeunload",this.onBeforeUnload,!1),window.addEventListener("message",this.receiveMsg),this.eventEmitterSubscriptions.push(Ee.subscribe("appId available",(function(){return e.defineHeaders()}))),this.eventEmitterSubscriptions.push(Ee.subscribe("open poll form for e2e",(function(){var t=[{event:$.PollShowed}];e.toShowPoll(t)})))}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){var t=M.getFeature("chat"),a=!this.props.windowGotFocus&&e.windowGotFocus,n=!this.props.windowGotBlur&&e.windowGotBlur,r=!["disconnected","not connected"].includes(t.status);if(a){if(he.updateAllStoreFromLocalStorage(),this.defineHeaders(),t&&!t.chatIsOpened&&Ee.dispatch("new messages",{type:"new messages",data:t.newMessages}),t&&["disconnected","not connected"].includes(t.status))return this.userEventsSent=!1,this.chatInited=!1,he.updateAllStoreFromLocalStorage(),this.chatPause$.next(!1),this.stopFlow$.next(),void Ee.dispatch("session started",{type:"session started",data:!1});r&&this.checkIfSessionIsAlive(!0)}n&&(this.setState({typing:!1}),this.chatInited&&"disconnected"!==this.props.chat.status&&this.chatPause$.next(!0),this.props.config.isIPad&&Ee.dispatch("deactivate textarea"))}},{key:"componentDidUpdate",value:function(e){e.chat.events.length===this.props.chat.events.length&&e.chat.archive.length===this.props.chat.archive.length||Ee.dispatch("events updated")}},{key:"componentWillUnmount",value:function(){window.removeEventListener("message",this.receiveMsg),this.stopFlow$.next(),this.stopFlow$.complete(),this.chatRef.current&&this.chatRef.current.removeEventListener("touchmove",Ge,{passive:!1}),this.footerRef.current&&this.footerRef.current.removeEventListener("touchmove",this.preventFooterTouchmove,!0),this.eventEmitterSubscriptions.forEach((function(e){return e.unsubscribe()})),this.userEventSubscription.unsubscribe(),this.sendNotTypingEvent()}},{key:"handleSubmitPoll",value:function(e){var t=this.props.chat.pollFormData,a=t.id,n=t.name;Se.sendPollForm(this.props.chat.chat_id,{pollFormData:{id:a,name:n},form:e},this.customHeaders),he.setCurrentStep(X.Message),setTimeout((function(){he.setCurrentStep(X.Dialog)}),2e3)}},{key:"resultState",value:function(e,t,a,n){return n>Number(a)-Number(t)?X.Dialog:e}},{key:"UNSAFE_componentWillMount",value:function(){void 0===this.props.chat.currentStep&&he.setCurrentStep(X.Dialog)}},{key:"sendTypingEvent",value:function(){this.props.chat.chat_id&&this.sendEvents([{event:$.Typing,msg:"\u041f\u0435\u0447\u0430\u0442\u0430\u0435\u0442"}]).pipe(Object(qt.a)((function(e){return Wt.a}))).subscribe()}},{key:"sleep",value:function(e){for(var t=(new Date).getTime(),a=0;a<1e7&&!((new Date).getTime()-t>e);a++);}},{key:"chatLayout",value:function(e){var t=this;switch(e){case X.Dialog:return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{"data-step":X.Dialog,className:hn.a["chat-zone"]},r.a.createElement(ln,{chat:this.props.chat,config:this.props.config,chatGlobalSetting:this.props.chatGlobalSetting,windowGotFocus:this.props.windowGotFocus,windowGotBlur:this.props.windowGotBlur}),r.a.createElement(Ua,{ref:this.typingNotifyRef,typing:this.state.typing})),r.a.createElement("footer",{ref:this.footerRef,className:Rt.isMobile()?hn.a["mobile-footer"]:""},r.a.createElement(en,{chat:this.props.chat,attachFiles:r.a.createElement(ra,{handleUserFiles:this.handleUserFiles,isMobile:this.props.config.isMobile,isTablet:this.props.config.isTablet,disabled:!1}),handleUserMessage:this.handleUserMessage,onTextAreaKeyUp:this.onTyping,chatIsOpenedLocalState:this.props.chatIsOpenedLocalState,reInitChat:this.reInitChat})));case X.Poll:var a=!Rt.isMobile();return r.a.createElement("div",{className:hn.a["chat-zone"],"data-step":X.Poll},r.a.createElement(ba,{scrollToBottom:!1,scrolledToBottom:!1,showScrollAlways:a,touchPreventExceptions:["form-radio","rc-slider","poll-form_submit","poll-form_reset","range-slider"],slot:r.a.createElement(Da,{form:this.props.chat.pollForm,onSubmit:function(e){return t.handleSubmitPoll(e)},onReset:function(){t.requestForTerminateSession((function(){he.setLastActivity(),he.setCurrentStep(X.Dialog),Xe(t.props.chat.events),t.chatPause$.next(!0),t.onSessionTerminated(),t.gettingActiveChat=!1}))}})}));case X.Message:return r.a.createElement("div",{className:hn.a["chat-zone"],"data-step":X.Message},r.a.createElement("div",{className:hn.a.background},r.a.createElement("div",{className:hn.a["post-poll-message"]},r.a.createElement("h3",null,"\u0421\u043f\u0430\u0441\u0438\u0431\u043e \u0437\u0430 \u043e\u0446\u0435\u043d\u043a\u0443!"),r.a.createElement("div",{className:hn.a["regular-text"]},"\u041e\u0431\u0440\u0430\u0449\u0430\u0439\u0442\u0435\u0441\u044c \u0437\u0430\xa0\u043a\u043e\u043d\u0441\u0443\u043b\u044c\u0442\u0430\u0446\u0438\u0435\u0439 \u0432\xa0\u043b\u044e\u0431\u043e\u0435 \u0432\u0440\u0435\u043c\u044f."))));default:throw Error('State with index "'.concat(e,'" does not exist in ChatState'))}}},{key:"render",value:function(){return r.a.createElement("div",{ref:this.chatRef,className:hn.a.chat,onDragEnter:this.onDragEnter},r.a.createElement(ca,{showDropZone:this.state.showDropZone,hideDropZone:this.hideDropZone,handleUserFiles:this.handleUserFiles}),this.chatLayout(this.props.chat.currentStep))}}]),a}(r.a.PureComponent);dn.UserTypingThrottle=1500,dn.LeavingDelay=500;var pn=ue((function(e){return{chat:e.chat,config:e.config,parties:e.parties,stopWords:e.stopWords}}))(dn),fn=(a(250),function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){return this.props.chat.chatIsOpened?r.a.createElement("div",{className:"settings"},"SETTINGS"):r.a.createElement(p.a,{to:"/"})}}]),a}(r.a.PureComponent)),vn=ue((function(e){return{chat:e.chat}}))(fn),mn=(a(251),a(252),function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).appRef=void 0,n.chatInterTabBus=new BroadcastChannel("tsum-chat-bus"),n.state={chatIsOpenedLocalState:!1,windowGotFocus:!1,windowGotBlur:!1},n.appRef=r.a.createRef(),n.receiveMsg=n.receiveMsg.bind(Object(l.a)(n)),n.closeChat=n.closeChat.bind(Object(l.a)(n)),n.sendMsg=n.sendMsg.bind(Object(l.a)(n)),n.openChat=n.openChat.bind(Object(l.a)(n)),n}return Object(c.a)(a,[{key:"UNSAFE_componentWillMount",value:function(){var e=this;Ee.subscribe("textarea focus",(function(){return e.sendMsg({type:"inner event",data:"textarea focus"})})),Ee.subscribe("textarea blur",(function(){return e.sendMsg({type:"inner event",data:"textarea blur"})})),Ee.subscribe("user sent message",(function(){return e.sendMsg({type:"inner event",data:"user sent message"})})),Ee.subscribe("session started",(function(t){return e.sendMsg(t)})),Ee.subscribe("new messages",(function(t){return e.sendMsg(t)})),Ee.subscribe("navigation",(function(t){return e.sendMsg(t)})),Ee.subscribe("command",(function(t){return e.sendMsg(t)})),Ee.subscribe("add ipad-chrome patch",(function(){return e.sendMsg({type:"command",data:"add ipad-chrome patch"})})),Ee.subscribe("remove ipad-chrome patch",(function(){return e.sendMsg({type:"command",data:"remove ipad-chrome patch"})})),Ee.subscribe("all operators are busy",(function(){return e.sendMsg({type:"analytics",data:"all operators are busy"})})),Ee.subscribe("operator joins chat",(function(){return e.sendMsg({type:"analytics",data:"operator joins chat"})})),Ee.subscribe("operator's first message",(function(){return e.sendMsg({type:"analytics",data:"operator's first message"})})),Ee.subscribe("chat session closed",(function(){return e.sendMsg({type:"analytics",data:"chat session closed"})}))}},{key:"componentDidMount",value:function(){var e=localStorage.getItem("uuid");window.addEventListener("message",this.receiveMsg),window.addEventListener("storage",he.updateAllStoreFromLocalStorage,!1),this.chatInterTabBus.addEventListener("message",this.openChat);var t={origin:this.props.chatGlobalSetting.ORIGIN,cdnOrigin:this.props.chatGlobalSetting.CDN_ORIGIN,version:this.props.chatGlobalSetting.VERSION};this.props.chatGlobalSetting.APP_ID&&(t.appId=this.props.chatGlobalSetting.APP_ID),he.setChatGlobalSettings(t).then((function(){Ee.dispatch("appId available")})),he.setNavData({url:this.props.chatGlobalSetting.REFERER,title:this.props.chatGlobalSetting.REFERER_TITLE,breadcrumbs:this.props.chatGlobalSetting.BREAD_CRUMBS,screen:this.props.chatGlobalSetting.SCREEN,absoluteUrl:this.props.chatGlobalSetting.ABSOLUTE_URL}),this.sendMsg({type:"chat loaded",data:!0}),this.sendMsg({type:"uuid",data:e?e.replace(/"/g,""):""})}},{key:"componentWillUnmount",value:function(){window.removeEventListener("message",this.receiveMsg),window.removeEventListener("storage",he.updateAllStoreFromLocalStorage,!1),this.chatInterTabBus.removeEventListener("message",this.openChat),this.sendMsg({type:"chat loaded",data:!1})}},{key:"openChat",value:function(e){"open chat"===e.data&&this.sendMsg({type:"command",data:"start chat"})}},{key:"receiveMsg",value:function(e){var t=this;if(de(e,"data","type")&&(e.origin===this.props.chatGlobalSetting.ORIGIN||"http://localhost:4200"===e.origin)&&["command","outer event","navigation","animationstart","animationend"].includes(e.data.type))switch(e.data.type){case"command":if("start chat"===e.data.data){if(this.state.chatIsOpenedLocalState)return;this.sendMsg({type:"new messages",data:0}),this.setState({chatIsOpenedLocalState:!0},(function(){he.setChat({chatIsOpened:!0,newMessages:0}),Ee.dispatch("chat opened"),Ee.dispatch("activate textarea"),t.chatInterTabBus.postMessage("open chat")}))}else if("hide chat"===e.data.data){if(!this.state.chatIsOpenedLocalState)return;this.setState({chatIsOpenedLocalState:!1},(function(){he.setChat({chatIsOpened:!1}),Ee.dispatch("chat closed"),Ee.dispatch("deactivate textarea"),t.chatInterTabBus.postMessage("close chat")}))}break;case"outer event":"focus"===e.data.data?this.setState({windowGotFocus:!0},(function(){t.setState({windowGotFocus:!1})})):"blur"===e.data.data&&this.setState({windowGotBlur:!0},(function(){t.setState({windowGotBlur:!1})}));break;case"navigation":he.setNavData(e.data.data);break;case"animationstart":Ee.dispatch("animation start");break;case"animationend":Ee.dispatch("animation end")}}},{key:"sendMsg",value:function(e){var t=this.props.chatGlobalSetting?this.props.chatGlobalSetting.ORIGIN:"http://localhost:4200";try{window.parent.postMessage(e,t)}catch(a){console.error("Chat should be laucnhed inside iframe")}}},{key:"closeChat",value:function(){this.sendMsg({type:"command",data:"hide chat"})}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"app"},r.a.createElement(le,null,r.a.createElement(d.a,{basename:"/chat-widget/".concat("2.1.5","/")},r.a.createElement(Ft,{close:this.closeChat,chatGlobalSetting:this.props.chatGlobalSetting}),r.a.createElement("main",null,r.a.createElement(p.d,null,r.a.createElement(p.b,{path:"/",exact:!0,render:function(){return r.a.createElement(Lt,null)}}),r.a.createElement(p.b,{path:"/chat",render:function(){return r.a.createElement(pn,{chatGlobalSetting:e.props.chatGlobalSetting,chatIsOpenedLocalState:e.state.chatIsOpenedLocalState,windowGotFocus:e.state.windowGotFocus,windowGotBlur:e.state.windowGotBlur,chat:!0})}}),r.a.createElement(p.b,{path:"/settings",render:function(){return r.a.createElement(vn,null)}}),r.a.createElement(p.a,{to:"/chat"}))))))}}]),a}(r.a.PureComponent));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(mn,{chatGlobalSetting:CHAT_GLOBAL_SETTING}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},32:function(e,t,a){e.exports={background:"poll-form_background__unpcX","background--android":"poll-form_background--android__3O2sL","background--iphone":"poll-form_background--iphone__sxX96","background--mobile-long":"poll-form_background--mobile-long__2lllZ",field__header:"poll-form_field__header__9c1bc","field-slider--control":"poll-form_field-slider--control__2W8Wg","field-slider__header":"poll-form_field-slider__header__104cv",reset:"poll-form_reset__2qAW6",submit:"poll-form_submit__2WFMS",buttons:"poll-form_buttons__aZBKg"}},48:function(e,t,a){e.exports={chat:"chat_chat__15vtC","chat-zone":"chat_chat-zone__9OIFT","mobile-footer":"chat_mobile-footer__s3qIZ",background:"chat_background__1qtZ_","post-poll-message":"chat_post-poll-message__f1ffj"}},57:function(e,t,a){e.exports={"slider-wrapper":"range-slider_slider-wrapper__3y97n",stamps:"range-slider_stamps__pQc7J","range-slider":"range-slider_range-slider__Mx5g_",rail:"range-slider_rail__3SQRa",track:"range-slider_track__rmZ1G",handle:"range-slider_handle__-I1g7"}},66:function(e,t,a){e.exports={wrapper:"length-counter_wrapper__ND9H-",counter:"length-counter_counter__1wNiK",numerator:"length-counter_numerator__nMjAh",delimiter:"length-counter_delimiter__teSUl",denominator:"length-counter_denominator__39JZC","max-length-overflowed":"length-counter_max-length-overflowed__nkraP"}},67:function(e,t,a){e.exports={"chat-dialog-form":"chat-dialog-form_chat-dialog-form__3HRpX","chat-dialog-form__form":"chat-dialog-form_chat-dialog-form__form__3DDDi","button-placeholder":"chat-dialog-form_button-placeholder__2g36p","button-wrapper":"chat-dialog-form_button-wrapper__3vCt6","attach-files-wrapper":"chat-dialog-form_attach-files-wrapper__17MVs"}},76:function(e,t,a){e.exports={header:"chat-header_header__1UoiP","in-mobile-device":"chat-header_in-mobile-device__h3W5e",links:"chat-header_links__3UDO7",version:"chat-header_version__1ROAP","header-row":"chat-header_header-row__1GgIA",title:"chat-header_title__1UiBJ","chat-roll-down":"chat-header_chat-roll-down__JiL1J","can-hover":"chat-header_can-hover__3TRyp"}},77:function(e,t,a){e.exports={"attach-file-outer":"attach-files_attach-file-outer__10a4d","hide-input":"attach-files_hide-input__3lTcK","attach-files-label":"attach-files_attach-files-label__RjIXV","can-hover":"attach-files_can-hover__3RcQL","label-icon":"attach-files_label-icon__3VV_j",disabled:"attach-files_disabled__1ZWZX"}},78:function(e,t,a){e.exports={"form-group":"textarea_form-group__31DCS","form-textarea":"textarea_form-textarea__3EkHI","fake-textarea":"textarea_fake-textarea__2noFb","length-counter-wrapper":"textarea_length-counter-wrapper__23VwH","localstorage-counter":"textarea_localstorage-counter__18GAy"}},79:function(e,t,a){e.exports={"button-outer":"button-send_button-outer__1xnDI","button-send":"button-send_button-send__E3G1Y","button-send__img-black":"button-send_button-send__img-black__ASHIQ","can-hover":"button-send_can-hover__10uSU","button-send__img-orange":"button-send_button-send__img-orange__3tUW5",disabled:"button-send_disabled__2RURK"}},99:function(e,t,a){e.exports={"drop-zone":"dropzone_drop-zone__282x4","show-drop-zone":"dropzone_show-drop-zone__368RL","drop-zone-text":"dropzone_drop-zone-text__1s2_I"}}},[[253,1,2]]]);
//# sourceMappingURL=main.3737a80f.chunk.js.map